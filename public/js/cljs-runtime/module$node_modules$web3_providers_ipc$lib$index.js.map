{
"version":3,
"file":"module$node_modules$web3_providers_ipc$lib$index.js",
"lineCount":8,
"mappings":"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",
"sources":["node_modules/web3-providers-ipc/lib/index.js"],
"sourcesContent":["shadow$provide[\"module$node_modules$web3_providers_ipc$lib$index\"] = function(global,require,module,exports) {\n/*\n    This file is part of web3.js.\n\n    web3.js is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Lesser General Public License as published by\n    the Free Software Foundation, either version 3 of the License, or\n    (at your option) any later version.\n\n    web3.js is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Lesser General Public License for more details.\n\n    You should have received a copy of the GNU Lesser General Public License\n    along with web3.js.  If not, see <http://www.gnu.org/licenses/>.\n*/\n/** @file index.js\n * @authors:\n *   Fabian Vogelsteller <fabian@ethereum.org>\n * @date 2017\n */\n\"use strict\";\nvar errors = require('web3-core-helpers').errors;\nvar oboe = require('oboe');\nvar IpcProvider = function IpcProvider(path, net) {\n    var _this = this;\n    this.responseCallbacks = {};\n    this.notificationCallbacks = [];\n    this.path = path;\n    this.connected = false;\n    this.connection = net.connect({ path: this.path });\n    this.addDefaultEvents();\n    // LISTEN FOR CONNECTION RESPONSES\n    var callback = function (result) {\n        /*jshint maxcomplexity: 6 */\n        var id = null;\n        // get the id which matches the returned id\n        if (Array.isArray(result)) {\n            result.forEach(function (load) {\n                if (_this.responseCallbacks[load.id])\n                    id = load.id;\n            });\n        }\n        else {\n            id = result.id;\n        }\n        // notification\n        if (!id && result.method.indexOf('_subscription') !== -1) {\n            _this.notificationCallbacks.forEach(function (callback) {\n                if (typeof callback === 'function')\n                    callback(result);\n            });\n            // fire the callback\n        }\n        else if (_this.responseCallbacks[id]) {\n            _this.responseCallbacks[id](null, result);\n            delete _this.responseCallbacks[id];\n        }\n    };\n    // use oboe.js for Sockets\n    if (net.constructor.name === 'Socket') {\n        oboe(this.connection)\n            .done(callback);\n    }\n    else {\n        this.connection.on('data', function (data) {\n            _this._parseResponse(data.toString()).forEach(callback);\n        });\n    }\n};\n/**\nWill add the error and end event to timeout existing calls\n\n@method addDefaultEvents\n*/\nIpcProvider.prototype.addDefaultEvents = function () {\n    var _this = this;\n    this.connection.on('connect', function () {\n        _this.connected = true;\n    });\n    this.connection.on('close', function () {\n        _this.connected = false;\n    });\n    this.connection.on('error', function () {\n        _this._timeout();\n    });\n    this.connection.on('end', function () {\n        _this._timeout();\n    });\n    this.connection.on('timeout', function () {\n        _this._timeout();\n    });\n};\n/**\n Will parse the response and make an array out of it.\n\n NOTE, this exists for backwards compatibility reasons.\n\n @method _parseResponse\n @param {String} data\n */\nIpcProvider.prototype._parseResponse = function (data) {\n    var _this = this, returnValues = [];\n    // DE-CHUNKER\n    var dechunkedData = data\n        .replace(/\\}[\\n\\r]?\\{/g, '}|--|{') // }{\n        .replace(/\\}\\][\\n\\r]?\\[\\{/g, '}]|--|[{') // }][{\n        .replace(/\\}[\\n\\r]?\\[\\{/g, '}|--|[{') // }[{\n        .replace(/\\}\\][\\n\\r]?\\{/g, '}]|--|{') // }]{\n        .split('|--|');\n    dechunkedData.forEach(function (data) {\n        // prepend the last chunk\n        if (_this.lastChunk)\n            data = _this.lastChunk + data;\n        var result = null;\n        try {\n            result = JSON.parse(data);\n        }\n        catch (e) {\n            _this.lastChunk = data;\n            // start timeout to cancel all requests\n            clearTimeout(_this.lastChunkTimeout);\n            _this.lastChunkTimeout = setTimeout(function () {\n                _this._timeout();\n                throw errors.InvalidResponse(data);\n            }, 1000 * 15);\n            return;\n        }\n        // cancel timeout and set chunk to null\n        clearTimeout(_this.lastChunkTimeout);\n        _this.lastChunk = null;\n        if (result)\n            returnValues.push(result);\n    });\n    return returnValues;\n};\n/**\nGet the adds a callback to the responseCallbacks object,\nwhich will be called if a response matching the response Id will arrive.\n\n@method _addResponseCallback\n*/\nIpcProvider.prototype._addResponseCallback = function (payload, callback) {\n    var id = payload.id || payload[0].id;\n    var method = payload.method || payload[0].method;\n    this.responseCallbacks[id] = callback;\n    this.responseCallbacks[id].method = method;\n};\n/**\nTimeout all requests when the end/error event is fired\n\n@method _timeout\n*/\nIpcProvider.prototype._timeout = function () {\n    for (var key in this.responseCallbacks) {\n        if (this.responseCallbacks.hasOwnProperty(key)) {\n            this.responseCallbacks[key](errors.InvalidConnection('on IPC'));\n            delete this.responseCallbacks[key];\n        }\n    }\n};\n/**\n Try to reconnect\n\n @method reconnect\n */\nIpcProvider.prototype.reconnect = function () {\n    this.connection.connect({ path: this.path });\n};\nIpcProvider.prototype.send = function (payload, callback) {\n    // try reconnect, when connection is gone\n    if (!this.connection.writable)\n        this.connection.connect({ path: this.path });\n    this.connection.write(JSON.stringify(payload));\n    this._addResponseCallback(payload, callback);\n};\n/**\nSubscribes to provider events.provider\n\n@method on\n@param {String} type    'notification', 'connect', 'error', 'end' or 'data'\n@param {Function} callback   the callback to call\n*/\nIpcProvider.prototype.on = function (type, callback) {\n    if (typeof callback !== 'function')\n        throw new Error('The second parameter callback must be a function.');\n    switch (type) {\n        case 'data':\n            this.notificationCallbacks.push(callback);\n            break;\n        // adds error, end, timeout, connect\n        default:\n            this.connection.on(type, callback);\n            break;\n    }\n};\n/**\n Subscribes to provider events.provider\n\n @method on\n @param {String} type    'connect', 'error', 'end' or 'data'\n @param {Function} callback   the callback to call\n */\nIpcProvider.prototype.once = function (type, callback) {\n    if (typeof callback !== 'function')\n        throw new Error('The second parameter callback must be a function.');\n    this.connection.once(type, callback);\n};\n/**\nRemoves event listener\n\n@method removeListener\n@param {String} type    'data', 'connect', 'error', 'end' or 'data'\n@param {Function} callback   the callback to call\n*/\nIpcProvider.prototype.removeListener = function (type, callback) {\n    var _this = this;\n    switch (type) {\n        case 'data':\n            this.notificationCallbacks.forEach(function (cb, index) {\n                if (cb === callback)\n                    _this.notificationCallbacks.splice(index, 1);\n            });\n            break;\n        default:\n            this.connection.removeListener(type, callback);\n            break;\n    }\n};\n/**\nRemoves all event listeners\n\n@method removeAllListeners\n@param {String} type    'data', 'connect', 'error', 'end' or 'data'\n*/\nIpcProvider.prototype.removeAllListeners = function (type) {\n    switch (type) {\n        case 'data':\n            this.notificationCallbacks = [];\n            break;\n        default:\n            this.connection.removeAllListeners(type);\n            break;\n    }\n};\n/**\nResets the providers, clears all callbacks\n\n@method reset\n*/\nIpcProvider.prototype.reset = function () {\n    this._timeout();\n    this.notificationCallbacks = [];\n    this.connection.removeAllListeners('error');\n    this.connection.removeAllListeners('end');\n    this.connection.removeAllListeners('timeout');\n    this.addDefaultEvents();\n};\n/**\n * Returns the desired boolean.\n *\n * @method supportsSubscriptions\n * @returns {boolean}\n */\nIpcProvider.prototype.supportsSubscriptions = function () {\n    return true;\n};\nmodule.exports = IpcProvider;\n\n};"],
"names":["shadow$provide","global","require","module","exports","errors","oboe","IpcProvider","path","net","_this","responseCallbacks","notificationCallbacks","connected","connection","connect","addDefaultEvents","callback","result","id","Array","isArray","forEach","load","method","indexOf","constructor","name","done","on","data","_parseResponse","toString","prototype","IpcProvider.prototype.addDefaultEvents","_timeout","IpcProvider.prototype._parseResponse","returnValues","replace","split","dechunkedData","lastChunk","JSON","parse","e","clearTimeout","lastChunkTimeout","setTimeout","InvalidResponse","push","_addResponseCallback","IpcProvider.prototype._addResponseCallback","payload","IpcProvider.prototype._timeout","key","hasOwnProperty","InvalidConnection","reconnect","IpcProvider.prototype.reconnect","send","IpcProvider.prototype.send","writable","write","stringify","IpcProvider.prototype.on","type","Error","once","IpcProvider.prototype.once","removeListener","IpcProvider.prototype.removeListener","cb","index","splice","removeAllListeners","IpcProvider.prototype.removeAllListeners","reset","IpcProvider.prototype.reset","supportsSubscriptions","IpcProvider.prototype.supportsSubscriptions"]
}
