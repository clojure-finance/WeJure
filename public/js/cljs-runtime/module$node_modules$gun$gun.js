shadow$provide.module$node_modules$gun$gun=function(global,require,module,exports){(function(){function USE(arg,req){return req?require(arg):arg.slice?USE[arg.split("/").slice(-1).toString().replace(".js","")]:function(mod,path){arg(mod={exports:{}});USE[path.split("/").slice(-1).toString().replace(".js","")]=mod.exports}}if("undefined"!==typeof module)var MODULE=module;USE(function(module){String.random=function(l,c){var s="";l=l||24;for(c=c||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";0<
l--;)s+=c.charAt(Math.floor(Math.random()*c.length));return s};String.match=function(t,o){if("string"!==typeof t)return!1;"string"==typeof o&&(o={"\x3d":o});o=o||{};var tmp=o["\x3d"]||o["*"]||o["\x3e"]||o["\x3c"];if(t===tmp)return!0;if(void 0!==o["\x3d"])return!1;tmp=o["*"]||o["\x3e"];return t.slice(0,(tmp||"").length)===tmp?!0:void 0!==o["*"]?!1:void 0!==o["\x3e"]&&void 0!==o["\x3c"]?t>=o["\x3e"]&&t<=o["\x3c"]?!0:!1:void 0!==o["\x3e"]&&t>=o["\x3e"]||void 0!==o["\x3c"]&&t<=o["\x3c"]?!0:!1};String.hash=
function(s,c){if("string"===typeof s){c=c||0;if(!s.length)return c;for(var i=0,l=s.length,n;i<l;++i)n=s.charCodeAt(i),c=(c<<5)-c+n,c|=0;return c}};var has=Object.prototype.hasOwnProperty;Object.plain=function(o){return o?o instanceof Object&&o.constructor===Object||"Object"===Object.prototype.toString.call(o).match(/^\[object (\w+)\]$/)[1]:!1};Object.empty=function(o,n){for(var k in o)if(has.call(o,k)&&(!n||-1==n.indexOf(k)))return!1;return!0};Object.keys=Object.keys||function(o){var l=[],k;for(k in o)has.call(o,
k)&&l.push(k);return l};(function(){var sT=setTimeout,l=0,c$jscomp$0=0,sI="undefined"!==typeof setImmediate&&setImmediate||function(c,f){if("undefined"==typeof MessageChannel)return sT;(c=new MessageChannel).port1.onmessage=function(e){""==e.data&&f()};return function(q){f=q;c.port2.postMessage("")}}(),check=sT.check=sT.check||"undefined"!==typeof performance&&performance||{now:function(){return+new Date}};sT.hold=sT.hold||9;sT.poll=sT.poll||function(f){sT.hold>=check.now()-l&&3333>c$jscomp$0++?f():
sI(function(){l=check.now();f()},c$jscomp$0=0)}})();(function(){var sT=setTimeout,t=sT.turn=sT.turn||function(f){1==s.push(f)&&p(T)},s=t.s=[],p=sT.poll,i=0,f$jscomp$0,T=function(){(f$jscomp$0=s[i++])&&f$jscomp$0();if(i==s.length||99==i)s=t.s=s.slice(i),i=0;s.length&&p(T)}})();(function(){var sT=setTimeout,T=sT.turn;(sT.each=sT.each||function(l,f,e,S){S=S||9;(function t(s,L,r){if(L=(s=(l||[]).splice(0,S)).length){for(var i=0;i<L&&void 0===(r=f(s[i]));i++);if(void 0===r){T(t);return}}e&&e(r)})()})()})()})(USE,
"./shim");USE(function(module){module.exports=function onto(tag,arg$jscomp$0,as){if(!tag)return{to:onto};var f="function"==typeof arg$jscomp$0;tag=(this.tag||(this.tag={}))[tag]||f&&(this.tag[tag]={tag,to:onto._={next:function(arg){var tmp;(tmp=this.to)&&tmp.next(arg)}}});if(f)return arg$jscomp$0={off:onto.off||(onto.off=function(){if(this.next===onto._.next)return!0;this===this.the.last&&(this.the.last=this.back);this.to.back=this.back;this.next=onto._.next;this.back.to=this.to;this.the.last===this.the&&
delete this.on.tag[this.the.tag]}),to:onto._,next:arg$jscomp$0,the:tag,on:this,as},(arg$jscomp$0.back=tag.last||tag).to=arg$jscomp$0,tag.last=arg$jscomp$0;(tag=tag.to)&&void 0!==arg$jscomp$0&&tag.next(arg$jscomp$0);return tag}})(USE,"./onto");USE(function(module){module.exports=function(v){return null===v||"string"===typeof v||"boolean"===typeof v||"number"===typeof v&&Infinity!=v&&-Infinity!=v&&v===v||!!v&&"string"==typeof v["#"]&&1===Object.keys(v).length&&v["#"]}})(USE,"./valid");USE(function(module){function State(){var t=
+new Date;return last<t?(N=0,last=t+State.drift):last=t+(N+=1)/D+State.drift}USE("./shim");var N=State.drift=0,D=999,last=-Infinity;State.is=function(n,k,o){if(n=k&&n&&n._&&n._["\x3e"]||o)return"number"==typeof(n=n[k])?n:-Infinity};State.ify=function(n,k,s,v,soul){(n=n||{})._=n._||{};soul&&(n._["#"]=soul);soul=n._["\x3e"]||(n._["\x3e"]={});void 0!==k&&"_"!==k&&("number"==typeof s&&(soul[k]=s),void 0!==v&&(n[k]=v));return n};module.exports=State})(USE,"./state");USE(function(module){USE("./shim");
module.exports=function(opt){var dup={s:{}},s=dup.s;opt=opt||{max:999,age:9E3};dup.check=function(id){return s[id]?dt(id):!1};var dt=dup.track=function(id){var it=s[id]||(s[id]={});it.was=dup.now=+new Date;dup.to||(dup.to=setTimeout(dup.drop,opt.age+9));dt.ed&&dt.ed(id);return it};dup.drop=function(age){dup.to=null;dup.now=+new Date;var l=Object.keys(s);console.STAT&&console.STAT(dup.now,+new Date-dup.now,"dup drop keys");setTimeout.each(l,function(id){var it=s[id];it&&(age||opt.age)>dup.now-it.was||
delete s[id]},0,99)};return dup}})(USE,"./dup");USE(function(module){USE("./onto");module.exports=function(cb,as){if(this.on){var lack=(this.opt||{}).lack||9E3;if("function"!=typeof cb){if(!cb)return;var id=cb["#"]||cb,tmp=(this.tag||"")[id];if(!tmp)return;as&&(tmp=this.on(id,as),clearTimeout(tmp.err),tmp.err=setTimeout(function(){tmp.off()},lack));return!0}id=as&&as["#"]||random(9);if(!cb)return id;var to=this.on(id,cb,as);to.err=to.err||setTimeout(function(){to.off();to.next({err:"Error: No ACK yet.",
lack:!0})},lack);return id}};var random=String.random||function(){return Math.random().toString(36).slice(2)}})(USE,"./ask");USE(function(module){function Gun(o){return o instanceof Gun?(this._={$:this}).$:this instanceof Gun?Gun.create(this._={$:this,opt:o}):new Gun(o)}Gun.is=function($){return $ instanceof Gun||$&&$._&&$===$._.$||!1};Gun.version=.202;Gun.chain=Gun.prototype;Gun.chain.toJSON=function(){};USE("./shim");Gun.valid=USE("./valid");Gun.state=USE("./state");Gun.on=USE("./onto");Gun.dup=
USE("./dup");Gun.ask=USE("./ask");(function(){function universe(msg){if(msg)if(msg.out===universe)this.to.next(msg);else{var as=this.as;as=as.at||as;var gun=as.$,dup=as.dup,tmp,DBG=msg.DBG;(tmp=msg["#"])||(tmp=msg["#"]=text_rand(9));if(!dup.check(tmp)){dup.track(tmp);tmp=msg._;msg._="function"==typeof tmp?tmp:function(){};msg.$&&msg.$===(msg.$._||"").$||(msg.$=gun);msg["@"]&&!msg.put&&ack(msg);if(!as.ask(msg["@"],msg)){DBG&&(DBG.u=+new Date);if(msg.put){put(msg);return}msg.get&&Gun.on.get(msg,gun)}DBG&&
(DBG.uc=+new Date);this.to.next(msg);DBG&&(DBG.ua=+new Date);msg.nts||msg.NTS||(msg.out=universe,as.on("out",msg),DBG&&(DBG.ue=+new Date))}}}function put(msg){if(msg){var ctx=msg._||"",root=ctx.root=((ctx.$=msg.$||"")._||"").root;if(msg["@"]&&ctx.faith&&!ctx.miss)msg.out=universe,root.on("out",msg);else{ctx.latch=root.hatch;ctx.match=root.hatch=[];var put=msg.put,DBG=ctx.DBG=msg.DBG,S=+new Date;CT=CT||S;if(!put["#"]||!put["."]){DBG&&(DBG.p=S);ctx["#"]=msg["#"];ctx.msg=msg;ctx.all=0;ctx.stun=1;var nl=
Object.keys(put);console.STAT&&console.STAT(S,((DBG||ctx).pk=+new Date)-S,"put sort");var ni=0,nj,kl,soul,node,states,err,tmp;(function pop(o){if(nj!=ni){nj=ni;if(!(soul=nl[ni])){console.STAT&&console.STAT(S,((DBG||ctx).pd=+new Date)-S,"put");fire(ctx);return}(node=put[soul])?(tmp=node._)?soul!==tmp["#"]?err=ERR+cut(soul)+"soul not same.":(states=tmp["\x3e"])||(err=ERR+cut(soul)+"no state."):err=ERR+cut(soul)+"no meta.":err=ERR+cut(soul)+"no node.";kl=Object.keys(node||{})}if(err)msg.err=ctx.err=
err,fire(ctx);else{var i=0,key;for(o=o||0;9>o++&&(key=kl[i++]);)if("_"!==key){var val=node[key],state=states[key];if(u===state){err=ERR+cut(key)+"on"+cut(soul)+"no state.";break}if(!valid(val)){err=ERR+cut(key)+"on"+cut(soul)+"bad "+typeof val+cut(val);break}ham(val,key,soul,state,msg);++C}(kl=kl.slice(i)).length?turn(pop):(++ni,kl=null,pop(o))}})()}}}}function ham(val,key,soul,state,msg){var ctx=msg._||"",root=ctx.root,graph=root.graph,tmp,vertex=graph[soul]||empty,was=state_is(vertex,key,1),known=
vertex[key];vertex=ctx.DBG;if(tmp=console.STAT)graph[soul]&&known||(tmp.has=(tmp.has||0)+1);graph=State();if(state>graph)setTimeout(function(){ham(val,key,soul,state,msg)},(tmp=state-graph)>MD?MD:tmp),console.STAT&&console.STAT((vertex||ctx).Hf=+new Date,tmp,"future");else if(!(state<was||!ctx.faith&&state===was&&(val===known||L(val)<=L(known))&&!ctx.miss)){ctx.stun++;var aid=msg["#"]+ctx.all++;was={toString:function(){return aid},_:ctx};was.toJSON=was.toString;root.dup.track(was)["#"]=msg["#"];vertex&&
(vertex.ph=vertex.ph||+new Date);root.on("put",{"#":was,"@":msg["@"],put:{"#":soul,".":key,":":val,"\x3e":state},ok:msg.ok,_:ctx})}}function map(msg){var DBG;if(DBG=(msg._||"").DBG)DBG.pa=+new Date,DBG.pm=DBG.pm||+new Date;DBG=this.as;var graph=DBG.graph,ctx=msg._,put=msg.put,soul=put["#"],key=put["."],val=put[":"];put=put["\x3e"];var tmp;(tmp=ctx.msg)&&(tmp=tmp.put)&&(tmp=tmp[soul])&&state_ify(tmp,key,put,val,soul);graph[soul]=state_ify(graph[soul],key,put,val,soul);if(tmp=(DBG.next||"")[soul])tmp.on("in",
msg);fire(ctx);this.to.next(msg)}function fire(ctx,msg){var root;if(!(ctx.stop||!ctx.err&&0<--ctx.stun)&&(ctx.stop=1,root=ctx.root)){var tmp=ctx.match;tmp.end=1;tmp===root.hatch&&(!(tmp=ctx.latch)||tmp.end?delete root.hatch:root.hatch=tmp);ctx.hatch&&ctx.hatch();setTimeout.each(ctx.match,function(cb){cb&&cb()});!(msg=ctx.msg)||ctx.err||msg.err||(msg.out=universe,ctx.root.on("out",msg),CF())}}function ack(msg){var id=msg["@"]||"",ctx;if(ctx=id._){ctx.acks=(ctx.acks||0)+1;if(ctx.err=msg.err)msg["@"]=
ctx["#"],fire(ctx);ctx.ok=msg.ok||ctx.ok;ctx.stop||ctx.crack||(ctx.crack=ctx.match&&ctx.match.push(function(){back(ctx)}));back(ctx)}else{var dup=(dup=msg.$)&&(dup=dup._)&&(dup=dup.root)&&(dup=dup.dup);if(dup=dup.check(id))msg["@"]=dup["#"]||msg["@"]}}function back(ctx){if(ctx&&ctx.root&&!ctx.stun&&ctx.acks===ctx.all)ctx.root.on("in",{"@":ctx["#"],err:ctx.err,ok:ctx.err?u:ctx.ok||{"":1}})}Gun.create=function(at){at.root=at.root||at;at.graph=at.graph||{};at.on=at.on||Gun.on;at.ask=at.ask||Gun.ask;
at.dup=at.dup||Gun.dup();var gun=at.$.opt(at.opt);at.once||(at.on("in",universe,at),at.on("out",universe,at),at.on("put",map,at),Gun.on("create",at),at.on("create",at));at.once=1;return gun};Gun.on.put=put;var ERR="Error: Invalid graph!",cut=function(s){return" '"+(""+s).slice(0,9)+"...' "},L=JSON.stringify,MD=2147483647,State=Gun.state,C=0,CT,CF=function(){999<C&&1<C/-(CT-(CT=+new Date))&&(Gun.window&&console.log("Warning: You're syncing 1K+ records a second, faster than DOM can update - consider limiting query."),
CF=function(){C=0})}})();(function(){function ack(msg,node){var S=+new Date,ctx=msg._||{},DBG=ctx.DBG=msg.DBG,to=msg["#"],id=text_rand(9),keys=Object.keys(node||"").sort(),soul=((node||"")._||"")["#"],root=msg.$._.root,F=node===root.graph[soul];console.STAT&&console.STAT(S,((DBG||ctx).gk=+new Date)-S,"got keys");node&&function go(){S=+new Date;for(var i=0,k,put={};9>i&&(k=keys[i++]);)state_ify(put,k,state_is(node,k),node[k],soul);keys=keys.slice(i);(i={})[soul]=put;put=i;if(F){var faith=function(){};
faith.ram=faith.faith=!0}i=keys.length;console.STAT&&console.STAT(S,-(S-(S=+new Date)),"got copied some");DBG&&(DBG.ga=+new Date);root.on("in",{"@":to,"#":id,put,"%":i?id=text_rand(9):u,$:root.$,_:faith,DBG,FOO:1});console.STAT&&console.STAT(S,+new Date-S,"got in");i&&setTimeout.turn(go)}();if(!node)root.on("in",{"@":msg["#"]})}Gun.on.get=function(msg,gun){gun=gun._;var get=msg.get,soul=get["#"],node=gun.graph[soul];get=get["."];var at=(gun.next||(gun.next={}))[soul],DBG=(msg._||{}).DBG=msg.DBG;DBG&&
(DBG.g=+new Date);if(!node)return gun.on("get",msg);if(get){if(("string"!=typeof get||u===node[get])&&!((at||"").next||"")[get]){gun.on("get",msg);return}node=state_ify({},get,state_is(node,get),node[get],soul)}node&&ack(msg,node);gun.on("get",msg)};Gun.on.get.ack=ack})();(function(){Gun.chain.opt=function(opt){opt=opt||{};var at=this._,tmp=opt.peers||opt;Object.plain(opt)||(opt={});Object.plain(at.opt)||(at.opt=opt);"string"==typeof tmp&&(tmp=[tmp]);Object.plain(at.opt.peers)||(at.opt.peers={});
tmp instanceof Array&&(opt.peers={},tmp.forEach(function(url){var p={};p.id=p.url=url;opt.peers[url]=at.opt.peers[url]=at.opt.peers[url]||p}));obj_each(opt,function each(k){var v=this[k];this&&this.hasOwnProperty(k)||"string"==typeof v||Object.empty(v)?this[k]=v:(!v||v.constructor===Object||v instanceof Array)&&obj_each(v,each)});at.opt.from=opt;Gun.on("opt",at);at.opt.uuid=at.opt.uuid||function(l){return Gun.state().toString(36).replace(".","")+String.random(l||12)};return this}})();var obj_each=
function(o,f){Object.keys(o).forEach(f,o)},text_rand=String.random,turn=setTimeout.turn,valid=Gun.valid,state_is=Gun.state.is,state_ify=Gun.state.ify,u,empty={},C;Gun.log=function(){return!Gun.log.off&&C.log.apply(C,arguments),[].slice.call(arguments).join(" ")};Gun.log.once=function(w,s,o){return(o=Gun.log.once)[w]=o[w]||0,o[w]++||Gun.log(s)};"undefined"!==typeof window&&((window.GUN=window.Gun=Gun).window=window);try{"undefined"!==typeof MODULE&&(MODULE.exports=Gun)}catch(e){}module.exports=Gun;
(Gun.window||{}).console=(Gun.window||{}).console||{log:function(){}};(C=console).only=function(i,s){return C.only.i&&i===C.only.i&&C.only.i++&&(C.log.apply(C,arguments)||s)};"Please do not remove welcome log unless you are paying for a monthly sponsorship, thanks!";Gun.log.once("welcome","Hello wonderful person! :) Thanks for using GUN, please ask for help on http://chat.gun.eco if anything takes you longer than 5min to figure out!")})(USE,"./root");USE(function(module){USE("./root").chain.back=
function(n,opt){n=n||1;if(-1===n||Infinity===n)return this._.root.$;if(1===n)return(this._.back||this._).$;var at=this._;"string"===typeof n&&(n=n.split("."));if(n instanceof Array){var i=0,l=n.length;var tmp=at;for(i;i<l;i++)tmp=(tmp||empty)[n[i]];if(u!==tmp)return opt?this:tmp;if(tmp=at.back)return tmp.$.back(n,opt)}else{if("function"==typeof n){for(tmp={back:at};(tmp=tmp.back)&&u===(i=n(tmp,opt)););return i}return"number"==typeof n?(at.back||at).$.back(n-1):this}};var empty={},u})(USE,"./back");
USE(function(module){function link(msg,cat){cat=cat||this.as||msg.$._;if((!msg.$$||this===Gun.on)&&msg.put&&!cat.soul){var put=msg.put||"",link=put["\x3d"]||put[":"],tmp;msg=cat.root;put=msg.$.get(put["#"]).get(put["."])._;if("string"!=typeof(link=valid(link)))this===Gun.on&&((put.echo||(put.echo={}))[cat.id]=cat);else if(!(put.echo||(put.echo={}))[cat.id]||(msg.pass||"")[cat.id]){if(tmp=msg.pass){if(tmp[link+cat.id])return;tmp[link+cat.id]=1}(put.echo||(put.echo={}))[cat.id]=cat;cat.has&&(cat.link=
link);msg=msg.$.get(put.link=link)._;(msg.echo||(msg.echo={}))[put.id]=put;tmp=cat.ask||"";if(tmp[""]||cat.lex)msg.on("out",{get:{"#":link}});setTimeout.each(Object.keys(tmp),function(get,sat){if(get&&(sat=tmp[get]))sat.on("out",{get:{"#":link,".":get}})},0,99)}}}function unlink(msg,cat){var put=msg.put||"";put=u!==put["\x3d"]?put["\x3d"]:put[":"];var root=cat.root,link;if(u===put){if(!cat.soul||u===cat.put)if(put=(msg.$$||msg.$||"")._||"",!msg["@"]||u===put.put&&u===cat.put)(link=cat.link||msg.linked)&&
delete (root.$.get(link)._.echo||"")[cat.id],cat.has&&(cat.link=null),cat.put=u,setTimeout.each(Object.keys(cat.next||""),function(get,sat){if(sat=cat.next[get])link&&delete (root.$.get(link).get(get)._.echo||"")[sat.id],sat.on("in",{get,put:u,$:sat.$})},0,99)}else!cat.soul&&!msg.$$&&(link=valid(put),put=msg.$._||"",link!==put.link&&(!cat.has||put.link)||(root.pass||"")[cat.id]&&"string"!==typeof link)&&(delete (put.echo||"")[cat.id],unlink({get:cat.get,put:u,$:msg.$,linked:msg.linked=msg.linked||
put.link},cat))}function ack(msg,ev){var as=this.as;ev=as.$._;as=as.get||"";var tmp=(msg.put||"")[as["#"]]||"";!msg.put||"string"==typeof as["."]&&u===tmp[as["."]]?u===ev.put&&(ev.soul||ev.has)&&(ev.ack=(ev.ack||0)+1,ev.on("in",{get:ev.get,put:ev.put=u,$:ev.$,"@":msg["@"]})):((msg._||{}).miss=1,Gun.on.put(msg))}var Gun=USE("./root");Gun.chain.chain=function(sub){var at=this._;sub=new (sub||this).constructor(this);var cat=sub._;cat.root=at=at.root;cat.id=++at.once;cat.back=this._;cat.on=Gun.on;cat.on("in",
Gun.on.in,cat);cat.on("out",Gun.on.out,cat);return sub};Gun.on.out=function(msg){var get,at=this.as,back=at.back,root=at.root,tmp;msg.$||(msg.$=at.$);this.to.next(msg);if(at.err)at.on("in",{put:at.put=u,$:at.$});else{if(get=msg.get){root.pass&&(root.pass[at.id]=at);at.lex&&Object.keys(at.lex).forEach(function(k){tmp[k]=at.lex[k]},tmp=msg.get=msg.get||{});if(get["#"]||at.soul){get["#"]=get["#"]||at.soul;msg["#"]||(msg["#"]=text_rand(9));back=root.$.get(get["#"])._;if(!(get=get["."])){tmp=back.ask&&
back.ask[""];(back.ask||(back.ask={}))[""]=back;if(u!==back.put&&(back.on("in",back),tmp))return;msg.$=back.$}else if(obj_has(back.put,get)&&(tmp=back.ask&&back.ask[get],(back.ask||(back.ask={}))[get]=back.$.get(get)._,back.on("in",{get,put:{"#":back.soul,".":get,":":back.put[get],"\x3e":state_is(root.graph[back.soul],get)}}),tmp))return;root.ask(ack,msg);return root.on("in",msg)}if(get["."]){if(at.get)return msg={get:{".":at.get},$:at.$},(back.ask||(back.ask={}))[at.get]=msg.$._,back.on("out",msg);
msg={get:at.lex?msg.get:{},$:at.$};return back.on("out",msg)}(at.ask||(at.ask={}))[""]=at;at.get&&(get["."]=at.get,(back.ask||(back.ask={}))[at.get]=msg.$._)}return back.on("out",msg)}};Gun.on.in=function(msg,cat){cat=cat||this.as;var root=cat.root,gun=msg.$||(msg.$=cat.$),at=(gun||"")._||empty,tmp=msg.put||"",soul=tmp["#"],key=tmp["."],change=u!==tmp["\x3d"]?tmp["\x3d"]:tmp[":"],state=tmp["\x3e"]||-Infinity,sat;if(u!==msg.put&&(u===tmp["#"]||u===tmp["."]||u===tmp[":"]&&u===tmp["\x3d"]||u===tmp["\x3e"])){if(!valid(tmp)){if(!(soul=
((tmp||"")._||"")["#"])){console.log("chain not yet supported for",tmp,"...",msg,cat);return}gun=cat.root.$.get(soul);return setTimeout.each(Object.keys(tmp).sort(),function(k){if("_"!=k&&u!==(state=state_is(tmp,k)))cat.on("in",{$:gun,put:{"#":soul,".":k,"\x3d":tmp[k],"\x3e":state},VIA:msg})})}cat.on("in",{$:at.back.$,put:{"#":soul=at.back.soul,".":key=at.has||at.get,"\x3d":tmp,"\x3e":state_is(at.back.put,key)},via:msg})}else(msg.seen||"")[cat.id]||((msg.seen||(msg.seen=function(){}))[cat.id]=cat,
cat!==at&&(Object.keys(msg).forEach(function(k){tmp[k]=msg[k]},tmp={}),tmp.get=cat.get||tmp.get,cat.soul||cat.has?at.soul&&(tmp.$=cat.$,tmp.$$=tmp.$$||at.$):tmp.$$$=tmp.$$$||cat.$,msg=tmp),unlink(msg,cat),(cat.soul||msg.$$)&&state>=state_is(root.graph[soul],key)&&((tmp=root.$.get(soul)._).put=state_ify(tmp.put,key,state,change,soul)),!at.soul&&state>=state_is(root.graph[soul],key)&&(sat=(root.$.get(soul)._.next||"")[key])&&(sat.put=change,"string"==typeof(tmp=valid(change))&&(sat.put=root.$.get(tmp)._.put||
change)),this.to&&this.to.next(msg),cat.any&&setTimeout.each(Object.keys(cat.any),function(any){(any=cat.any[any])&&any(msg)},0,99),cat.echo&&setTimeout.each(Object.keys(cat.echo),function(lat){(lat=cat.echo[lat])&&lat.on("in",msg)},0,99),((msg.$$||"")._||at).soul&&(sat=cat.next)&&(sat=sat[key])&&(tmp={},Object.keys(msg).forEach(function(k){tmp[k]=msg[k]}),tmp.$=(msg.$$||msg.$).get(tmp.get=key),delete tmp.$$,delete tmp.$$$,sat.on("in",tmp)),link(msg,cat))};Gun.on.link=link;Gun.on.unlink=unlink;var empty=
{},u,text_rand=String.random,valid=Gun.valid,obj_has=function(o,k){return o&&Object.prototype.hasOwnProperty.call(o,k)};module=Gun.state;var state_is=module.is,state_ify=module.ify})(USE,"./chain");USE(function(module){function cache(key,back){var cat=back._,next=cat.next,at=back.chain()._;next||(next=cat.next={});next[at.get=key]=at;if(back===cat.root.$)at.soul=key;else if(cat.soul||cat.has)at.has=key;return at}function soul(gun,cb$jscomp$0,opt,as$jscomp$0){var cat=gun._,acks=0,tmp;if(tmp=cat.soul||
cat.link)return cb$jscomp$0(tmp,as$jscomp$0,cat);if(cat.jam)return cat.jam.push([cb$jscomp$0,as$jscomp$0]);cat.jam=[[cb$jscomp$0,as$jscomp$0]];gun.get(function(msg,eve){if(!(u===msg.put&&!cat.root.opt.super&&(tmp=Object.keys(cat.root.opt.peers).length)&&++acks<=tmp)){eve.rid(msg);var at=(at=msg.$)&&at._||{},i=0,as;tmp=cat.jam;for(delete cat.jam;as=tmp[i++];){var cb=as[0];as=as[1];cb&&cb(at.link||at.soul||Gun.valid(msg.put)||((msg.put||{})._||{})["#"],as,msg,eve)}}},{out:{get:{".":!0}}});return gun}
function rid(at){var cat=this.at||this.on;if(!at||cat.soul||cat.has)return this.off();if(at=(at=(at=at.$||at)._||at).id){if((cat=this.seen||(this.seen={}))[at])return!0;cat[at]=!0}}var Gun=USE("./root");Gun.chain.get=function(key,cb,as){var gun;if("string"===typeof key){if(0==key.length)return(gun=this.chain())._.err={err:Gun.log("0 length key!",key)},cb&&cb.call(gun,gun._.err),gun;var cat=this._;(gun=(cat.next||empty)[key])||(gun=key&&cache(key,this));gun=gun&&gun.$}else{if("function"==typeof key){if(!0===
cb)return soul(this,key,cb,as),this;gun=this;cat=gun._;var opt=cb||{},root=cat.root,id;opt.at=cat;opt.ok=key;var wait={};function any(msg,eve,f){if(!any.stun&&(!(tmp=root.pass)||tmp[id])){var at=msg.$._,sat=(msg.$$||"")._,data=(sat||at).put,test={},tmp;if(!at.has&&!at.soul||u===data)data=u===((tmp=msg.put)||"")["\x3d"]?u===(tmp||"")[":"]?tmp:tmp[":"]:tmp["\x3d"];"string"==typeof(tmp=Gun.valid(data))&&(data=u===(tmp=root.$.get(tmp)._.put)?opt.not?u:data:tmp);if(!opt.not||u!==data){if(u===opt.stun){if((tmp=
root.stun)&&tmp.on&&(cat.$.back(function(a){tmp.on(""+a.id,test={});if((test.run||0)<any.id)return test}),!test.run&&tmp.on(""+at.id,test={}),!test.run&&sat&&tmp.on(""+sat.id,test={}),any.id>test.run)){if(!test.stun||test.stun.end)test.stun=tmp.on("stun"),test.stun=test.stun&&test.stun.last;if(test.stun&&!test.stun.end){(test.stun.add||(test.stun.add={}))[id]=function(){any(msg,eve,1)};return}}u===data&&(f=0);if((tmp=root.hatch)&&!tmp.end&&u===opt.hatch&&!f){if(wait[at.$._.id])return;wait[at.$._.id]=
1;tmp.push(function(){any(msg,eve,1)});return}wait={}}if(root.pass){if(root.pass[id+at.id])return;root.pass[id+at.id]=1}opt.on?opt.ok.call(at.$,data,at.get,msg,eve||any):opt.v2020?opt.ok(msg,eve||any):(Object.keys(msg).forEach(function(k){tmp[k]=msg[k]},tmp={}),msg=tmp,msg.put=data,opt.ok.call(opt.as,msg,eve||any))}}}any.at=cat;(cat.any||(cat.any={}))[id=String.random(7)]=any;any.off=function(){any.stun=1;cat.any&&delete cat.any[id]};any.rid=rid;any.id=opt.run||++root.once;var tmp$jscomp$0=root.pass;
(root.pass={})[id]=1;opt.out=opt.out||{get:{}};cat.on("out",opt.out);root.pass=tmp$jscomp$0;return gun}if("number"==typeof key)return this.get(""+key,cb,as);if("string"==typeof(tmp$jscomp$0=valid(key)))return this.get(tmp$jscomp$0,cb,as);if(tmp$jscomp$0=this.get.next)gun=tmp$jscomp$0(this,key)}if(!gun)return(gun=this.chain())._.err={err:Gun.log("Invalid get request!",key)},cb&&cb.call(gun,gun._.err),gun;cb&&"function"==typeof cb&&gun.get(cb,as);return gun};var empty={},valid=Gun.valid,u})(USE,"./get");
USE(function(module){function stun(as,id){if(id){id=(id._||"").id||id;var run=as.root.stun||(as.root.stun={on:Gun.on}),test$jscomp$0={},tmp;as.stun||(as.stun=run.on("stun",function(){}));(tmp=run.on(""+id))&&tmp.the.last.next(test$jscomp$0);if(!(test$jscomp$0.run>=as.run))run.on(""+id,function(test){as.stun.end?(this.off(),this.to.next(test)):(test.run=test.run||as.run,test.stun=test.stun||as.stun)})}}function ran(as){if(as.err)ran.end(as.stun,as.root);else if(!as.todo.length&&!as.end&&Object.empty(as.wait)){as.end=
1;var cat=as.$.back(-1)._,root=cat.root;cat=cat.ask(function(ack){root.on("ack",ack);ack.err&&!ack.lack&&Gun.log(ack);++acks>(as.acks||0)&&this.off();as.ack&&as.ack(ack,this)},as.opt);var acks=0,stun=as.stun,tmp;(tmp=function(){stun&&(ran.end(stun,root),setTimeout.each(Object.keys(stun=stun.add||""),function(cb){(cb=stun[cb])&&cb()}))}).hatch=tmp;as.ack&&!as.ok&&(as.ok=as.acks||9);as.via._.on("out",{put:as.out=as.graph,ok:as.ok&&{"@":as.ok+1},opt:as.opt,"#":cat,_:tmp})}}function get(as){var at$jscomp$0=
as.via._,tmp;as.via=as.via.back(function(at){if(at.soul||!at.get)return at.$;tmp=as.data;(as.data={})[at.get]=tmp});as.via&&as.via._.soul||(as.via=at$jscomp$0.root.$.get(((as.data||"")._||"")["#"]||at$jscomp$0.$.back("opt.uuid")()));as.via.put(as.data,as.ack,as)}function check(d,tmp){return d&&(tmp=d.constructor)&&tmp.name||typeof d}var Gun=USE("./root");Gun.chain.put=function(data,cb$jscomp$0,as){var gun=this,at$jscomp$1=gun._,root=at$jscomp$1.root;as=as||{};as.root=at$jscomp$1.root;as.run||(as.run=
root.once);stun(as,at$jscomp$1.id);as.ack=as.ack||cb$jscomp$0;as.via=as.via||gun;as.data=as.data||data;as.soul||(as.soul=at$jscomp$1.soul||"string"==typeof cb$jscomp$0&&cb$jscomp$0);var s=as.state=as.state||Gun.state();if("function"==typeof data)return data(function(d){as.data=d;gun.put(u,u,as)}),gun;if(!as.soul)return get(as),gun;as.$=root.$.get(as.soul);as.todo=[{it:as.data,ref:as.$}];as.turn=as.turn||turn;as.ran=as.ran||ran;(function walk(){var to=as.todo,at$jscomp$0=to.pop(),d=at$jscomp$0.it,
v,cat,tmp,g;stun(as,at$jscomp$0.ref);if(tmp=at$jscomp$0.todo){var k=tmp.pop();d=d[k];tmp.length&&to.push(at$jscomp$0)}k&&(to.path||(to.path=[])).push(k);if(!(v=valid(d))&&!(g=Gun.is(d))){if(!Object.plain(d)){ran.err(as,"Invalid data: "+check(d)+" at "+(as.via.back(function(at){at.get&&tmp.push(at.get)},tmp=[])||tmp.join("."))+"."+(to.path||[]).join("."));return}for(var seen=as.seen||(as.seen=[]),i=seen.length;i--;)if(d===(tmp=seen[i]).it){v=d=tmp.link;break}}if(k&&v)at$jscomp$0.node=state_ify(at$jscomp$0.node,
k,s,d);else{if(!as.seen){ran.err(as,"Data at root of graph must be a node (an object).");return}as.seen.push(cat={it:d,link:{},todo:g?[]:Object.keys(d).sort().reverse(),path:(to.path||[]).slice(),up:at$jscomp$0});at$jscomp$0.node=state_ify(at$jscomp$0.node,k,s,cat.link);!g&&cat.todo.length&&to.push(cat);var id=as.seen.length;(as.wait||(as.wait={}))[id]="";tmp=(cat.ref=g?d:k?at$jscomp$0.ref.get(k):at$jscomp$0.ref)._;(tmp=d&&(d._||"")["#"]||tmp.soul||tmp.link)?resolve({soul:tmp}):cat.ref.get(resolve,
{run:as.run,v2020:1,out:{get:{".":" "}}});function resolve(msg,eve){var end=cat.link["#"];eve&&(eve.off(),eve.rid(msg));var soul=end||msg.soul||(tmp=(msg.$$||msg.$)._||"").soul||tmp.link||((tmp=tmp.put||"")._||"")["#"]||tmp["#"]||((tmp=msg.put||"")&&msg.$$?tmp["#"]:(tmp["\x3d"]||tmp[":"]||"")["#"]);!end&&stun(as,msg.$);soul||at$jscomp$0.link["#"]?(soul||(soul=[],(msg.$$||msg.$).back(function(at){if(tmp=at.soul||at.link)return soul.push(tmp);soul.push(at.get)}),soul=soul.reverse().join("/")),cat.link["#"]=
soul,!g&&(((as.graph||(as.graph={}))[soul]=cat.node||(cat.node={_:{}}))._["#"]=soul),delete as.wait[id],cat.wait&&setTimeout.each(cat.wait,function(cb){cb&&cb()}),as.ran(as)):(at$jscomp$0.wait||(at$jscomp$0.wait=[])).push(function(){resolve(msg,eve)})}}if(!to.length)return as.ran(as);as.turn(walk)})();return gun};ran.end=function(stun,root){stun.end=noop;stun.the.to===stun&&stun===stun.the.last&&delete root.stun;stun.off()};ran.err=function(as,err){(as.ack||noop).call(as,as.out={err:as.err=Gun.log(err)});
as.ran(as)};var u,noop=function(){},turn=setTimeout.turn,valid=Gun.valid,state_ify=Gun.state.ify})(USE,"./put");USE(function(module){var Gun=USE("./root");USE("./chain");USE("./back");USE("./put");USE("./get");module.exports=Gun})(USE,"./index");USE(function(module){function none(gun,opt,chain){Gun.log.once("valonce","Chainable val is experimental, its behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it.");(chain=gun.chain())._.nix=gun.once(function(data,
key){chain._.on("in",this._)});chain._.lex=gun._.lex;return chain}var Gun=USE("./index");Gun.chain.on=function(tag,arg,eas,as){var cat=this._;if("string"===typeof tag){if(!arg)return cat.on(tag);tag=cat.on(tag,arg,eas||cat,as);eas&&eas.$&&(eas.subs||(eas.subs=[])).push(tag);return this}eas=arg;(eas=!0===eas?{change:!0}:eas||{}).not=1;eas.on=1;this.get(tag,eas);return this};Gun.chain.once=function(cb,opt){opt=opt||{};if(!cb)return none(this,opt);var cat=this._,root=cat.root,id=String.random(7),tmp;
this.get(function(data,key,msg,eve){function once(f){at.has||at.soul||(at={put:data,get:key});u===(tmp=at.put)&&(tmp=((msg.$$||"")._||"").put);if("string"==typeof Gun.valid(tmp)&&(tmp=root.$.get(tmp)._.put,tmp===u&&!f)){one[id]=setTimeout(function(){once(1)},opt.wait||99);return}eve.stun||""===one[id]||(one[id]="",(cat.soul||cat.has)&&eve.off(),cb.call($,tmp,at.get),clearTimeout(one[id]))}var $=this,at=$._,one=at.one||(at.one={});eve.stun||""===one[id]||(!0===(tmp=Gun.valid(data))?once():"string"!=
typeof tmp&&(clearTimeout((cat.one||"")[id]),clearTimeout(one[id]),one[id]=setTimeout(once,opt.wait||99)))},{on:1});return this};Gun.chain.off=function(){var at$jscomp$0=this._,tmp,cat=at$jscomp$0.back;if(cat){at$jscomp$0.ack=0;(tmp=cat.next)&&tmp[at$jscomp$0.get]&&delete tmp[at$jscomp$0.get];if(tmp=cat.any)delete cat.any,cat.any={};(tmp=cat.ask)&&delete tmp[at$jscomp$0.get];(tmp=cat.put)&&delete tmp[at$jscomp$0.get];(tmp=at$jscomp$0.soul)&&delete cat.root.graph[tmp];(tmp=at$jscomp$0.map)&&Object.keys(tmp).forEach(function(i,
at){at=tmp[i];at.link&&cat.root.$.get(at.link).off()});(tmp=at$jscomp$0.next)&&Object.keys(tmp).forEach(function(i,neat){neat=tmp[i];neat.$.off()});at$jscomp$0.on("off",{});return this}};var u})(USE,"./on");USE(function(module){function map(msg){this.to.next(msg);var cat=this.as,put=msg.put,tmp;if(msg.$._.soul||msg.$$)(tmp=cat.lex)&&!String.match(msg.get||(put||"")["."],tmp["."]||tmp["#"]||tmp)||Gun.on.link(msg,cat)}var Gun=USE("./index"),next=Gun.chain.get.next;Gun.chain.get.next=function(gun,lex){var tmp;
if(!Object.plain(lex))return(next||noop)(gun,lex);if(tmp=((tmp=lex["#"])||"")["\x3d"]||tmp)return gun.get(tmp);(tmp=gun.chain()._).lex=lex;gun.on("in",function(eve){if(String.match(eve.get||(eve.put||"")["."],lex["."]||lex["#"]||lex))tmp.on("in",eve);this.to.next(eve)});return tmp.$};Gun.chain.map=function(cb,opt,t){opt=this._;var chain;if(Object.plain(cb)){var lex=cb["."]?cb:{".":cb};cb=u}if(!cb){if(chain=opt.each)return chain;(opt.each=chain=this.chain())._.lex=lex||chain._.lex||opt.lex;chain._.nix=
this.back("nix");this.on("in",map,chain._);return chain}Gun.log.once("mapfn","Map functions are experimental, their behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it.");chain=this.chain();this.map().on(function(data,key,msg,eve){eve=(cb||noop).call(this,data,key,msg,eve);if(u!==eve){if(data===eve)return chain._.on("in",msg);if(Gun.is(eve))return chain._.on("in",eve._);var tmp={};Object.keys(msg.put).forEach(function(k){tmp[k]=msg.put[k]},
tmp);tmp["\x3d"]=eve;chain._.on("in",{get:key,put:tmp})}});return chain};var noop=function(){},u})(USE,"./map");USE(function(module){var Gun=USE("./index");Gun.chain.set=function(item,cb,opt){var gun=this,root=gun.back(-1),soul$jscomp$0,tmp;cb=cb||function(){};opt=opt||{};opt.item=opt.item||item;if(soul$jscomp$0=((item||"")._||"")["#"])(item={})["#"]=soul$jscomp$0;if("string"==typeof(tmp=Gun.valid(item)))return gun.get(soul$jscomp$0=tmp).put(item,cb,opt);if(!Gun.is(item))return Object.plain(item)&&
(item=root.get(soul$jscomp$0=gun.back("opt.uuid")()).put(item)),gun.get(soul$jscomp$0||root.back("opt.uuid")(7)).put(item,cb,opt);gun.put(function(go){item.get(function(soul,o,msg){if(!soul)return cb.call(gun,{err:Gun.log('Only a node can be linked! Not "'+msg.put+'"!')});(tmp={})[soul]={"#":soul};go(tmp)},!0)});return item}})(USE,"./set");USE(function(module){function Mesh(root$jscomp$0){function flush(peer){var tmp=peer.batch,t="string"==typeof tmp;t&&(tmp+="]");peer.batch=peer.tail=null;if(tmp&&
(t?!(3>tmp.length):tmp.length)){if(!t)try{tmp=1===tmp.length?tmp[0]:JSON.stringify(tmp)}catch(e){return opt.log("DAM JSON stringify error",e)}tmp&&send(tmp,peer)}}function send(raw,peer){try{var wire=peer.wire;peer.say?peer.say(raw):wire.send&&wire.send(raw);mesh.say.d+=raw.length||0;++mesh.say.c}catch(e){(peer.queue=peer.queue||[]).push(raw)}}var mesh=function(){},opt=root$jscomp$0.opt||{};opt.log=opt.log||console.log;opt.gap=opt.gap||opt.wait||0;opt.max=opt.max||.3*(opt.memory?998001*opt.memory:
3E8);opt.pack=opt.pack||1E-4*opt.max;opt.puff=opt.puff||9;var puff=setTimeout.turn||setTimeout,dup=root$jscomp$0.dup,dup_check=dup.check,dup_track=dup.track,hear=mesh.hear=function(raw,peer){if(raw){if(opt.max<=raw.length)return mesh.say({dam:"!",err:"Message too big!"},peer);mesh===this&&(hear.d+=raw.length||0,++hear.c);var S$jscomp$0=peer.SH=+new Date,tmp=raw[0],msg$jscomp$0;if("["===tmp)parse(raw,function(err,msg){if(err||!msg)return mesh.say({dam:"!",err:"DAM JSON parse error."},peer);console.STAT&&
console.STAT(+new Date,msg.length,"# on hear batch");var P=opt.puff;(function go(){for(var S=+new Date,i=0,m;i<P&&(m=msg[i++]);)mesh.hear(m,peer);msg=msg.slice(i);console.STAT&&console.STAT(S,+new Date-S,"hear loop");flush(peer);msg.length&&puff(go,0)})()}),raw="";else if("{"===tmp||(raw["#"]||Object.plain(raw))&&(msg$jscomp$0=raw)){if(msg$jscomp$0)return hear.one(msg$jscomp$0,peer,S$jscomp$0);parse(raw,function(err,msg){if(err||!msg)return mesh.say({dam:"!",err:"DAM JSON parse error."},peer);hear.one(msg,
peer,S$jscomp$0)})}}};hear.one=function(msg,peer,S){var id,tmp,ash,DBG;msg.DBG&&(msg.DBG=DBG={DBG:msg.DBG});DBG&&(DBG.h=S);DBG&&(DBG.hp=+new Date);(id=msg["#"])||(id=msg["#"]=String.random(9));if(!((tmp=dup_check(id))||(S=msg["##"],S&&(tmp=msg["@"]||msg.get&&id)&&dup.check(ash=tmp+S))))if((msg._=function(){}).via=mesh.leap=peer,(tmp=msg["\x3e\x3c"])&&"string"==typeof tmp&&tmp.slice(0,99).split(",").forEach(function(k){this[k]=1},msg._.yo={}),tmp=msg.dam)(tmp=mesh.hear[tmp])&&tmp(msg,peer,root$jscomp$0),
dup_track(id);else{if(tmp=msg.ok)msg._.near=tmp["/"];S=+new Date;DBG&&(DBG.is=S);peer.SI=id;dup_track.ed=function(d){id===d&&(dup_track.ed=0,d=dup.s[id])&&(d.via=peer,msg.get&&(d.it=msg))};root$jscomp$0.on("in",mesh.last=msg);DBG&&(DBG.hd=+new Date);console.STAT&&console.STAT(S,+new Date-S,msg.get?"msg get":msg.put?"msg put":"msg");dup_track(id);ash&&dup_track(ash);mesh.leap=mesh.last=null}};hear.c=hear.d=0;(function(){function sort(k,v){if(!(v instanceof Object))return v;Object.keys(v).sort().forEach(sorta,
{to:k={},on:v});return k}function sorta(k){this.to[k]=this.on[k]}var SMIA=0,loop;mesh.hash=function(msg,peer){var h,s,t,S=+new Date;json(msg.put,function hash(err,text){err=(s||(s=t=text||"")).slice(0,32768);h=String.hash(err,h);(s=s.slice(32768))?puff(hash,0):(console.STAT&&console.STAT(S,+new Date-S,"say json+hash"),msg._.$put=t,msg["##"]=h,mesh.say(msg,peer),delete msg._.$put)},sort)};mesh.say=function(msg,peer){var tmp;(tmp=this)&&(tmp=tmp.to)&&tmp.next&&tmp.next(msg);if(!msg)return!1;var id,
hash,raw,ack=msg["@"],meta=msg._||(msg._=function(){}),DBG=msg.DBG,S$jscomp$0=+new Date;meta.y=meta.y||S$jscomp$0;peer||DBG&&(DBG.y=S$jscomp$0);(id=msg["#"])||(id=msg["#"]=String.random(9));!loop&&dup_track(id);if((hash=msg["##"])||u===msg.put||meta.via||!ack){!peer&&ack&&(peer=(tmp=dup.s[ack])&&(tmp.via||(tmp=tmp.it)&&(tmp=tmp._)&&tmp.via)||(tmp=mesh.last)&&ack===tmp["#"]&&mesh.leap);if(!peer&&ack){if(dup.s[ack])return;console.STAT&&console.STAT(+new Date,++SMIA,"total no peer to ack to");return!1}if(ack&&
!msg.put&&!hash&&((dup.s[ack]||"").it||"")["##"])return!1;if(!peer&&mesh.way)return mesh.way(msg);DBG&&(DBG.yh=+new Date);if(raw=meta.raw)if(DBG&&(DBG.yr=+new Date),peer&&peer.id){if(!peer.wire&&mesh.wire&&mesh.wire(peer),id!==peer.last){peer.last=id;if(peer===meta.via||(tmp=meta.yo)&&(tmp[peer.url]||tmp[peer.pid]||tmp[peer.id]))return!1;console.STAT&&console.STAT(S$jscomp$0,((DBG||meta).yp=+new Date)-(meta.y||S$jscomp$0),"say prep");!loop&&ack&&dup_track(ack);if(peer.batch){peer.tail=(tmp=peer.tail||
0)+raw.length;if(peer.tail<=opt.pack){peer.batch+=(tmp?",":"")+raw;return}flush(peer)}peer.batch="[";var ST=+new Date;setTimeout(function(){console.STAT&&console.STAT(ST,+new Date-ST,"0ms TO");flush(peer)},opt.gap);send(raw,peer);console.STAT&&ack===peer.SI&&console.STAT(S$jscomp$0,+new Date-peer.SH,"say ack")}}else{if(!Object.plain(peer||opt.peers))return!1;S$jscomp$0=+new Date;var ps=opt.peers,pl=Object.keys(peer||opt.peers||{});console.STAT&&console.STAT(S$jscomp$0,+new Date-S$jscomp$0,"peer keys");
(function go(){var S=+new Date;loop=1;var wr=meta.raw;meta.raw=raw;for(var i=0,p;9>i&&(p=(pl||"")[i++]);)(p=ps[p]||(peer||"")[p])&&mesh.say(msg,p);meta.raw=wr;loop=0;pl=pl.slice(i);console.STAT&&console.STAT(S,+new Date-S,"say loop");pl.length&&(puff(go,0),ack&&dup_track(ack))})()}else mesh.raw(msg,peer)}else mesh.hash(msg,peer)};mesh.say.c=mesh.say.d=0;mesh.raw=function(msg,peer){function res(err,raw){err||(meta.raw=raw,mesh.say(msg,peer))}if(!msg)return"";var meta=msg._||{},put,tmp;if(tmp=meta.raw)return tmp;
if("string"==typeof msg)return msg;var hash=msg["##"],ack=msg["@"];if(hash&&ack){if(!meta.via&&dup_check(ack+hash))return!1;if(tmp=(dup.s[ack]||"").it){if(hash===tmp["##"])return!1;tmp["##"]||(tmp["##"]=hash)}}if(!msg.dam&&!msg["@"]){hash=0;ack=[];tmp=opt.peers;for(var k$jscomp$0 in tmp){var p=tmp[k$jscomp$0];ack.push(p.url||p.pid||p.id);if(6<++hash)break}1<hash&&(msg["\x3e\x3c"]=ack.join())}msg.put&&(tmp=msg.ok)&&(msg.ok={"@":(tmp["@"]||1)-1,"/":tmp["/"]==msg._.near?mesh.near:tmp["/"]});(put=meta.$put)?
(tmp={},Object.keys(msg).forEach(function(k){tmp[k]=msg[k]}),tmp.put=":])([:",json(tmp,function(err,raw){err||(err=+new Date,tmp=raw.indexOf('"put":":])([:"'),res(u,raw.slice(0,tmp+6)+put+raw.slice(tmp+14)),console.STAT&&console.STAT(err,+new Date-err,"say slice"))})):json(msg,res)}})();mesh.near=0;mesh.hi=function(peer){if(peer.wire){if(peer.id)opt.peers[peer.url||peer.id]=peer;else{var tmp=peer.id=peer.id||peer.url||String.random(9);mesh.say({dam:"?",pid:root$jscomp$0.opt.pid},opt.peers[tmp]=peer);
delete dup.s[peer.last]}peer.met||(mesh.near++,peer.met=+new Date,root$jscomp$0.on("hi",peer));tmp=peer.queue;peer.queue=[];setTimeout.each(tmp||[],function(msg){send(msg,peer)},0,9)}else mesh.wire(peer.length&&{url:peer,id:peer}||peer)};mesh.bye=function(peer){peer.met&&--mesh.near;delete peer.met;root$jscomp$0.on("bye",peer);var tmp=+new Date;tmp-=peer.met||tmp;mesh.bye.time=((mesh.bye.time||tmp)+tmp)/2};mesh.hear["!"]=function(msg,peer){opt.log("Error:",msg.err)};mesh.hear["?"]=function(msg,peer){if(msg.pid&&
(peer.pid||(peer.pid=msg.pid),msg["@"]))return;mesh.say({dam:"?",pid:opt.pid,"@":msg["#"]},peer);delete dup.s[peer.last]};mesh.hear.mob=function(msg,peer){msg.peers&&(msg=Object.keys(msg.peers),msg=msg[Math.random()*msg.length>>0])&&(mesh.bye(peer),mesh.hi(msg))};root$jscomp$0.on("create",function(root){root.opt.pid=root.opt.pid||String.random(9);this.to.next(root);root.on("out",mesh.say)});root$jscomp$0.on("bye",function(peer,tmp){peer=opt.peers[peer.id||peer]||peer;this.to.next(peer);peer.bye?peer.bye():
(tmp=peer.wire)&&tmp.close&&tmp.close();delete opt.peers[peer.id];peer.wire=null});var gets={};root$jscomp$0.on("bye",function(peer,tmp){this.to.next(peer);if(tmp=console.STAT)tmp.peers=mesh.near;if(tmp=peer.url)gets[tmp]=!0,setTimeout(function(){delete gets[tmp]},opt.lack||9E3)});root$jscomp$0.on("hi",function(peer,tmp){this.to.next(peer);if(tmp=console.STAT)tmp.peers=mesh.near;opt.super||(tmp=Object.keys(root$jscomp$0.next||""),9999<tmp.length&&!console.SUBS&&console.log(console.SUBS="Warning: You have more than 10K live GETs, which might use more bandwidth than your screen can show - consider `.off()`."),
setTimeout.each(tmp,function(soul){var node=root$jscomp$0.next[soul];opt.super||(node.ask||"")[""]?mesh.say({get:{"#":soul}},peer):setTimeout.each(Object.keys(node.ask||""),function(key){key&&mesh.say({"##":String.hash((root$jscomp$0.graph[soul]||"")[key]),get:{"#":soul,".":key}},peer)})}))});return mesh}USE("./shim");var noop=function(){},parse=JSON.parseAsync||function(t,cb,r){var d=+new Date;try{cb(void 0,JSON.parse(t,r),json.sucks(+new Date-d))}catch(e){cb(e)}},json=JSON.stringifyAsync||function(v,
cb,r,s){var d=+new Date;try{cb(void 0,JSON.stringify(v,r,s),json.sucks(+new Date-d))}catch(e){cb(e)}};json.sucks=function(d){99<d&&(console.log("Warning: JSON blocking CPU detected. Add `gun/lib/yson.js` to fix."),json.sucks=noop)};var u;try{module.exports=Mesh}catch(e){}})(USE,"./mesh");USE(function(module){var Gun=USE("./index");Gun.Mesh=USE("./mesh");Gun.on("opt",function(root){function open(peer){try{if(!peer||!peer.url)return wire&&wire(peer);var url=peer.url.replace(/^http/,"ws"),wire=peer.wire=
new opt.WebSocket(url);wire.onclose=function(){reconnect(peer);opt.mesh.bye(peer)};wire.onerror=function(err){reconnect(peer)};wire.onopen=function(){opt.mesh.hi(peer)};wire.onmessage=function(msg){msg&&opt.mesh.hear(msg.data||msg,peer)};return wire}catch(e){opt.mesh.bye(peer)}}function reconnect(peer){clearTimeout(peer.defer);!opt.peers[peer.url]||doc&&0>=peer.retry||(peer.retry=(peer.retry||opt.retry+1||60)-(-peer.tried+(peer.tried=+new Date)<4*wait?1:0),peer.defer=setTimeout(function to(){if(doc&&
doc.hidden)return setTimeout(to,wait);open(peer)},wait))}this.to.next(root);if(!root.once){var opt=root.opt;if(!1!==opt.WebSocket){var env=Gun.window||{};if(env=opt.WebSocket||env.WebSocket||env.webkitWebSocket||env.mozWebSocket){opt.WebSocket=env;(opt.mesh=opt.mesh||Gun.Mesh(root)).wire=opt.wire=open;setTimeout(function(){!opt.super&&root.on("out",{dam:"hi"})},1);var wait=1998,doc=""+u!==typeof document&&document}}}});var u})(USE,"./websocket");USE(function(module){if("undefined"!==typeof Gun){try{var store=
(Gun.window||function(){}).localStorage}catch(e){}store||(Gun.log("Warning: No localStorage exists to persist data to!"),store={setItem:function(k,v){this[k]=v},removeItem:function(k){delete this[k]},getItem:function(k){return this[k]}});var json=JSON.stringifyAsync||function(v,cb,r,s){try{cb(void 0,JSON.stringify(v,r,s))}catch(e){cb(e)}};Gun.on("create",function lg(root){function flush(){if(!acks.length&&((setTimeout.turn||"").s||"").length)setTimeout(flush,99);else{var ack=acks;clearTimeout(to);
to=!1;acks=[];json(disk,function(err,tmp){try{!err&&store.setItem(opt.prefix,tmp)}catch(e){err=stop=e||"localStorage failure"}err&&(Gun.log(err+" Consider using GUN's IndexedDB plugin for RAD for more storage space, https://gun.eco/docs/RAD#install"),root.on("localStorage:error",{err,get:opt.prefix,put:disk}));size=tmp.length;setTimeout.each(ack,function(id){root.on("in",{"@":id,err,ok:0})},0,99)})}}this.to.next(root);var opt=root.opt,acks=[],to,size,stop;if(!1!==opt.localStorage){opt.prefix=opt.file||
"gun/";try{var disk=lg[opt.prefix]=lg[opt.prefix]||JSON.parse(size=store.getItem(opt.prefix))||{}}catch(e){disk=lg[opt.prefix]={}}size=(size||"").length;root.on("get",function(msg){this.to.next(msg);var lex=msg.get,soul,data,tmp;lex&&(soul=lex["#"])&&((data=disk[soul]||void 0)&&(tmp=lex["."])&&!Object.plain(tmp)&&(data=Gun.state.ify({},tmp,Gun.state.is(data,tmp),data[tmp],soul)),Gun.on.get.ack(msg,data))});root.on("put",function(msg){this.to.next(msg);var put=msg.put,soul=put["#"],id=msg["#"],ok=
msg.ok||"";disk[soul]=Gun.state.ify(disk[soul],put["."],put["\x3e"],put[":"],soul);if(stop&&4999880<size)root.on("in",{"@":id,err:"localStorage max!"});else msg["@"]||msg._.via&&!(Math.random()<ok["@"]/ok["/"])||acks.push(id),to||(to=setTimeout(flush,9+size/333))})}})}})(USE,"./localStorage")})();(function(){if("undefined"!=typeof Gun){var DEP=function(n){console.warn("Warning! Deprecated internal utility will break in next version:",n)},Type=Gun;Type.fn=Type.fn||{is:function(fn){DEP("fn");return!!fn&&
"function"==typeof fn}};Type.bi=Type.bi||{is:function(b){DEP("bi");return b instanceof Boolean||"boolean"==typeof b}};Type.num=Type.num||{is:function(n){DEP("num");return!list_is(n)&&(0<=n-parseFloat(n)+1||Infinity===n||-Infinity===n)}};Type.text=Type.text||{is:function(t){DEP("text");return"string"==typeof t}};Type.text.ify=Type.text.ify||function(t){DEP("text.ify");return Type.text.is(t)?t:"undefined"!==typeof JSON?JSON.stringify(t):t&&t.toString?t.toString():t};Type.text.random=Type.text.random||
function(l,c){DEP("text.random");var s="";l=l||24;for(c=c||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";0<l;)s+=c.charAt(Math.floor(Math.random()*c.length)),l--;return s};Type.text.match=Type.text.match||function(t,o){DEP("text.match");if("string"!==typeof t)return!1;"string"==typeof o&&(o={"\x3d":o});o=o||{};var tmp=o["\x3d"]||o["*"]||o["\x3e"]||o["\x3c"];if(t===tmp)return!0;if(void 0!==o["\x3d"])return!1;tmp=o["*"]||o["\x3e"]||o["\x3c"];return t.slice(0,(tmp||"").length)===tmp?
!0:void 0!==o["*"]?!1:void 0!==o["\x3e"]&&void 0!==o["\x3c"]?t>=o["\x3e"]&&t<=o["\x3c"]?!0:!1:void 0!==o["\x3e"]&&t>=o["\x3e"]||void 0!==o["\x3c"]&&t<=o["\x3c"]?!0:!1};Type.text.hash=Type.text.hash||function(s,c){DEP("text.hash");if("string"===typeof s){c=c||0;if(!s.length)return c;for(var i=0,l=s.length,n;i<l;++i)n=s.charCodeAt(i),c=(c<<5)-c+n,c|=0;return c}};Type.list=Type.list||{is:function(l){DEP("list");return l instanceof Array}};Type.list.slit=Type.list.slit||Array.prototype.slice;Type.list.sort=
Type.list.sort||function(k){DEP("list.sort");return function(A,B){if(!A||!B)return 0;A=A[k];B=B[k];return A<B?-1:A>B?1:0}};Type.list.map=Type.list.map||function(l,c,_){DEP("list.map");return obj_map(l,c,_)};Type.list.index=1;Type.obj=Type.boj||{is:function(o){DEP("obj");return o?o instanceof Object&&o.constructor===Object||"Object"===Object.prototype.toString.call(o).match(/^\[object (\w+)\]$/)[1]:!1}};Type.obj.put=Type.obj.put||function(o,k,v){DEP("obj.put");return(o||{})[k]=v,o};Type.obj.has=Type.obj.has||
function(o,k){DEP("obj.has");return o&&Object.prototype.hasOwnProperty.call(o,k)};Type.obj.del=Type.obj.del||function(o,k){DEP("obj.del");if(o)return o[k]=null,delete o[k],o};Type.obj.as=Type.obj.as||function(o,k,v,u){DEP("obj.as");return o[k]=o[k]||(u===v?{}:v)};Type.obj.ify=Type.obj.ify||function(o){DEP("obj.ify");if(obj_is(o))return o;try{o=JSON.parse(o)}catch(e){o={}}return o};(function(){function map(v,k){obj_has(this,k)&&u!==this[k]||(this[k]=v)}var u;Type.obj.to=Type.obj.to||function(from,
to){DEP("obj.to");to=to||{};obj_map(from,map,to);return to}})();Type.obj.copy=Type.obj.copy||function(o){DEP("obj.copy");return o?JSON.parse(JSON.stringify(o)):o};(function(){function empty(v,i){v=this.n;if(!(v&&(i===v||obj_is(v)&&obj_has(v,i))||void 0===i))return!0}Type.obj.empty=Type.obj.empty||function(o,n){DEP("obj.empty");return o?obj_map(o,empty,{n})?!1:!0:!0}})();(function(){function t$jscomp$0(k,v){2===arguments.length?(t$jscomp$0.r=t$jscomp$0.r||{},t$jscomp$0.r[k]=v):(t$jscomp$0.r=t$jscomp$0.r||
[],t$jscomp$0.r.push(k))}var keys=Object.keys,map;Object.keys=Object.keys||function(o){return map(o,function(v,k,t){t(k)})};Type.obj.map=map=Type.obj.map||function(l,c,_){DEP("obj.map");var i=0,x,f="function"==typeof c;t$jscomp$0.r=void 0;if(keys&&obj_is(l)){var ll=keys(l);var lle=!0}_=_||{};if(list_is(l)||ll)for(x=(ll||l).length;i<x;i++){var r=i+Type.list.index;if(f){if(r=lle?c.call(_,l[ll[i]],ll[i],t$jscomp$0):c.call(_,l[i],r,t$jscomp$0),void 0!==r)return r}else if(c===l[lle?ll[i]:i])return ll?
ll[i]:r}else for(i in l)if(f){if(obj_has(l,i)&&(r=_?c.call(_,l[i],i,t$jscomp$0):c(l[i],i,t$jscomp$0),void 0!==r))return r}else if(c===l[i])return i;return f?t$jscomp$0.r:Type.list.index?0:-1}})();Type.time=Type.time||{};Type.time.is=Type.time.is||function(t){DEP("time");return t?t instanceof Date:+(new Date).getTime()};var fn_is=Type.fn.is,list_is=Type.list.is,obj$jscomp$0=Type.obj,obj_is=obj$jscomp$0.is,obj_has=obj$jscomp$0.has,obj_map=obj$jscomp$0.map,Val={is:function(v){DEP("val.is");return void 0===
v?!1:null===v?!0:Infinity===v?!1:text_is(v)||bi_is(v)||num_is(v)?!0:Val.link.is(v)||!1}};Val.link=Val.rel={_:"#"};(function(){function map(s,k){if(!this.id&&k==rel_&&text_is(s))this.id=s;else return this.id=!1}Val.link.is=function(v){DEP("val.link.is");if(v&&v[rel_]&&!v._&&obj_is(v)){var o={};obj_map(v,map,o);if(o.id)return o.id}return!1}})();Val.link.ify=function(t){DEP("val.link.ify");return obj_put({},rel_,t)};Type.obj.has._=".";var rel_=Val.link._,bi_is=Type.bi.is,num_is=Type.num.is,text_is=Type.text.is;
obj$jscomp$0=Type.obj;obj_is=obj$jscomp$0.is;var obj_put=obj$jscomp$0.put;obj_map=obj$jscomp$0.map;Type.val=Type.val||Val;var Node={_:"_",soul:function(n,o){DEP("node.soul");return n&&n._&&n._[o||soul_]}};Node.soul.ify=function(n,o){DEP("node.soul.ify");o="string"===typeof o?{soul:o}:o||{};n=n||{};n._=n._||{};n._[soul_]=o.soul||n._[soul_]||text_random();return n};Node.soul._=Val.link._;(function(){function map(v,k){if(k!==Node._){if(!Val.is(v))return!0;this.cb&&this.cb.call(this.as,v,k,this.n,this.s)}}
Node.is=function(n,cb,as){DEP("node.is");var s;return obj_is(n)?(s=Node.soul(n))?!obj_map(n,map,{as,cb,s,n}):!1:!1}})();(function(){function map(v,k){var o=this.o;o.map?(v=o.map.call(this.as,v,""+k,o.node),void 0===v?obj_del(o.node,k):o.node&&(o.node[k]=v)):Val.is(v)&&(o.node[k]=v)}Node.ify=function(obj,o,as){DEP("node.ify");o?"string"===typeof o?o={soul:o}:"function"==typeof o&&(o={map:o}):o={};o.map&&(o.node=o.map.call(as,obj,void 0,o.node||{}));(o.node=Node.soul.ify(o.node||{},o))&&obj_map(obj,
map,{o,as});return o.node}})();obj$jscomp$0=Type.obj;obj_is=obj$jscomp$0.is;var obj_del=obj$jscomp$0.del;obj_map=obj$jscomp$0.map;var text_random=Type.text.random,soul_=Node.soul._;Type.node=Type.node||Node;var State=Type.state;State.lex=function(){DEP("state.lex");return State().toString(36).replace(".","")};State.to=function(from,k,to){DEP("state.to");var val=(from||{})[k];obj_is(val)&&(val=obj_copy(val));return State.ify(to,k,State.is(from,k),val,Node.soul(from))};(function(){function map(v,k){N_!==
k&&State.ify(this.o,k,this.s)}State.map=function(cb,s,as){DEP("state.map");var o$jscomp$0=obj_is(o$jscomp$0=cb||s)?o$jscomp$0:null;cb=fn_is(cb=cb||s)?cb:null;if(o$jscomp$0&&!cb)return s=num_is(s)?s:State(),o$jscomp$0[N_]=o$jscomp$0[N_]||{},obj_map(o$jscomp$0,map,{o:o$jscomp$0,s}),o$jscomp$0;as=as||obj_is(s)?s:void 0;s=num_is(s)?s:State();return function(v,k,o,opt){if(!cb)return map.call({o,s},v,k),v;cb.call(as||this||{},v,k,o,opt);obj_has(o,k)&&void 0===o[k]||map.call({o,s},v,k)}}})();obj$jscomp$0=
Type.obj;obj_has=obj$jscomp$0.has;obj_is=obj$jscomp$0.is;obj_map=obj$jscomp$0.map;var obj_copy=obj$jscomp$0.copy;num_is=Type.num.is;fn_is=Type.fn.is;var N_=Node._,Graph={};(function(){function map(n,s){if(!n||s!==Node.soul(n)||!Node.is(n,this.fn,this.as))return!0;this.cb&&(nf.n=n,nf.as=this.as,this.cb.call(nf.as,n,s,nf))}function nf(fn){fn&&Node.is(nf.n,fn,nf.as)}Graph.is=function(g,cb,fn,as){DEP("graph.is");return g&&obj_is(g)&&!obj_empty(g)?!obj_map(g,map,{cb,fn,as}):!1}})();(function(){function node(env,
at){a:{var tmp=env.seen;for(var i=tmp.length,has;i--;)if(has=tmp[i],at.obj===has.obj){tmp=has;break a}tmp.push(at);tmp=void 0}if(tmp)return tmp;at.env=env;at.soul=soul;Node.ify(at.obj,map,at)&&(at.link=at.link||Val.link.ify(Node.soul(at.node)),at.obj!==env.shell&&(env.graph[Val.link.is(at.link)]=at.node));return at}function map(v,k,n){var env=this.env,is,tmp;if(Node._===k&&obj_has(v,Val.link._))return n._;if(is=valid(v,k,n,this,env)){k||(this.node=this.node||n||{},obj_has(v,Node._)&&Node.soul(v)&&
(this.node._=obj_copy(v._)),this.node=Node.soul.ify(this.node,Val.link.is(this.link)),this.link=this.link||Val.link.ify(Node.soul(this.node)));if(tmp=env.map)if(tmp.call(env.as||{},v,k,n,this),obj_has(n,k)){v=n[k];if(void 0===v){obj_del(n,k);return}if(!(is=valid(v,k,n,this,env)))return}if(!k)return this.node;if(!0===is)return v;tmp=node(env,{obj:v,path:this.path.concat(k)});if(tmp.node)return tmp.link}}function soul(id){var prev=Val.link.is(this.link),graph=this.env.graph;this.link=this.link||Val.link.ify(id);
this.link[Val.link._]=id;this.node&&this.node[Node._]&&(this.node[Node._][Val.link._]=id);obj_has(graph,prev)&&(graph[id]=graph[prev],obj_del(graph,prev))}function valid(v,k,n,at,env){var tmp;if(Val.is(v))return!0;if(obj_is(v))return 1;if(tmp=env.invalid)return v=tmp.call(env.as||{},v,k,n),valid(v,k,n,at,env);env.err="Invalid value at '"+at.path.concat(k).join(".")+"'!";Type.list.is(v)&&(env.err+=" Use `.set(item)` instead of an Array.")}Graph.ify=function(obj,env,as){DEP("graph.ify");obj={path:[],
obj};env?"string"===typeof env?env={soul:env}:"function"==typeof env&&(env.map=env):env={};"string"===typeof as&&(env.soul=env.soul||as,as=void 0);env.soul&&(obj.link=Val.link.ify(env.soul));env.shell=(as||{}).shell;env.graph=env.graph||{};env.seen=env.seen||[];env.as=env.as||as;node(env,obj);env.root=obj.node;return env.graph}})();Graph.node=function(node){DEP("graph.node");var soul=Node.soul(node);if(soul)return obj_put({},soul,node)};(function(){function map(v,k){var tmp,obj;Node._===k?obj_empty(v,
Val.link._)||(this.obj[k]=obj_copy(v)):(tmp=Val.link.is(v))?(obj=this.opt.seen[tmp])?this.obj[k]=obj:this.obj[k]=this.opt.seen[tmp]=Graph.to(this.graph,tmp,this.opt):this.obj[k]=v}Graph.to=function(graph,root,opt){DEP("graph.to");if(graph){var obj={};opt=opt||{seen:{}};obj_map(graph[root],map,{obj,graph,opt});return obj}}})();fn_is=Type.fn.is;obj$jscomp$0=Type.obj;obj_is=obj$jscomp$0.is;obj_del=obj$jscomp$0.del;obj_has=obj$jscomp$0.has;var obj_empty=obj$jscomp$0.empty;obj_put=obj$jscomp$0.put;obj_map=
obj$jscomp$0.map;obj_copy=obj$jscomp$0.copy;Type.graph=Type.graph||Graph}})()}
//# sourceMappingURL=module$node_modules$gun$gun.js.map
