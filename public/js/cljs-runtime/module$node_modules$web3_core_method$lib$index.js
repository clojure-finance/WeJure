shadow$provide.module$node_modules$web3_core_method$lib$index=function(global,require,module,exports){function _handleTxPricing(method,tx){return new Promise((resolve,reject)=>{try{var getBlockByNumber=(new Method({name:"getBlockByNumber",call:"eth_getBlockByNumber",params:2,inputFormatter:[function(blockNumber){return blockNumber?utils.toHex(blockNumber):"latest"},function(){return!1}]})).createFunction(method.requestManager),getGasPrice=(new Method({name:"getGasPrice",call:"eth_gasPrice",params:0})).createFunction(method.requestManager);
Promise.all([getBlockByNumber(),getGasPrice()]).then(responses=>{const [block,gasPrice]=responses;if(("0x2"===tx.type||void 0===tx.type)&&block&&block.baseFeePerGas){let maxFeePerGas;tx.gasPrice?(maxFeePerGas=responses=tx.gasPrice,delete tx.gasPrice):(responses=tx.maxPriorityFeePerGas||"0x9502F900",maxFeePerGas=tx.maxFeePerGas||utils.toHex(utils.toBN(block.baseFeePerGas).mul(utils.toBN(2)).add(utils.toBN(responses))));resolve({maxFeePerGas,maxPriorityFeePerGas:responses})}else{if(tx.maxPriorityFeePerGas||
tx.maxFeePerGas)throw Error("Network doesn't support eip-1559");resolve({gasPrice})}})}catch(error){reject(error)}})}var errors=require("module$node_modules$web3_core_helpers$lib$index").errors,formatters=require("module$node_modules$web3_core_helpers$lib$index").formatters,utils=require("module$node_modules$web3_utils$lib$index"),promiEvent=require("module$node_modules$web3_core_promievent$lib$index"),Subscriptions=require("module$node_modules$web3_core_subscriptions$lib$index").subscriptions,EthersTransactionUtils=
require("module$node_modules$$ethersproject$transactions$lib$index"),Method=function(options){if(!options.call||!options.name)throw Error('When creating a method you need to provide at least the "name" and "call" property.');this.name=options.name;this.call=options.call;this.params=options.params||0;this.inputFormatter=options.inputFormatter;this.outputFormatter=options.outputFormatter;this.transformPayload=options.transformPayload;this.extraFormatters=options.extraFormatters;this.abiCoder=options.abiCoder;
this.requestManager=options.requestManager;this.accounts=options.accounts;this.defaultBlock=options.defaultBlock||"latest";this.defaultAccount=options.defaultAccount||null;this.transactionBlockTimeout=options.transactionBlockTimeout||50;this.transactionConfirmationBlocks=options.transactionConfirmationBlocks||24;this.transactionPollingTimeout=options.transactionPollingTimeout||750;this.transactionPollingInterval=options.transactionPollingInterval||1E3;this.blockHeaderTimeout=options.blockHeaderTimeout||
10;this.defaultCommon=options.defaultCommon;this.defaultChain=options.defaultChain;this.defaultHardfork=options.defaultHardfork;this.handleRevert=options.handleRevert};Method.prototype.setRequestManager=function(requestManager,accounts){this.requestManager=requestManager;accounts&&(this.accounts=accounts)};Method.prototype.createFunction=function(requestManager,accounts){var func=this.buildCall();func.call=this.call;this.setRequestManager(requestManager||this.requestManager,accounts||this.accounts);
return func};Method.prototype.attachToObject=function(obj){var func=this.buildCall();func.call=this.call;var name=this.name.split(".");1<name.length?(obj[name[0]]=obj[name[0]]||{},obj[name[0]][name[1]]=func):obj[name[0]]=func};Method.prototype.getCall=function(args){return"function"===typeof this.call?this.call(args):this.call};Method.prototype.extractCallback=function(args){if("function"===typeof args[args.length-1])return args.pop()};Method.prototype.validateArgs=function(args){if(args.length!==
this.params)throw errors.InvalidNumberOfParams(args.length,this.params,this.name);};Method.prototype.formatInput=function(args){var _this=this;return this.inputFormatter?this.inputFormatter.map(function(formatter,index){return formatter?formatter.call(_this,args[index]):args[index]}):args};Method.prototype.formatOutput=function(result){var _this=this;return Array.isArray(result)?result.map(function(res){return _this.outputFormatter&&res?_this.outputFormatter(res):res}):this.outputFormatter&&result?
this.outputFormatter(result):result};Method.prototype.toPayload=function(args){var call=this.getCall(args),callback=this.extractCallback(args);args=this.formatInput(args);this.validateArgs(args);call={method:call,params:args,callback};this.transformPayload&&(call=this.transformPayload(call));return call};Method.prototype._confirmTransaction=function(defer,result,payload){var method=this,promiseResolved=!1,canUnsubscribe=!0,timeoutCount=0,confirmationCount=0,intervalId=null,blockHeaderTimeoutId=null,
lastBlock=null,gasProvided=payload.params[0]&&"object"===typeof payload.params[0]&&payload.params[0].gas?payload.params[0].gas:null,isContractDeployment=!!payload.params[0]&&"object"===typeof payload.params[0]&&payload.params[0].data&&payload.params[0].from&&!payload.params[0].to,hasBytecode=isContractDeployment&&2<payload.params[0].data.length,_ethereumCall={};[new Method({name:"getBlockByNumber",call:"eth_getBlockByNumber",params:2,inputFormatter:[formatters.inputBlockNumberFormatter,function(val){return!!val}],
outputFormatter:formatters.outputBlockFormatter}),new Method({name:"getTransactionReceipt",call:"eth_getTransactionReceipt",params:1,inputFormatter:[null],outputFormatter:formatters.outputTransactionReceiptFormatter}),new Method({name:"getCode",call:"eth_getCode",params:2,inputFormatter:[formatters.inputAddressFormatter,formatters.inputDefaultBlockNumberFormatter]}),new Method({name:"getTransactionByHash",call:"eth_getTransactionByHash",params:1,inputFormatter:[null],outputFormatter:formatters.outputTransactionFormatter}),
new Subscriptions({name:"subscribe",type:"eth",subscriptions:{newBlockHeaders:{subscriptionName:"newHeads",params:0,outputFormatter:formatters.outputBlockFormatter}}})].forEach(mthd=>{mthd.attachToObject(_ethereumCall);mthd.requestManager=method.requestManager});var checkConfirmation=function(existingReceipt,isPolling,err$jscomp$0,blockHeader,sub){if(err$jscomp$0)sub.unsubscribe(),promiseResolved=!0,utils._fireError({message:"Failed to subscribe to new newBlockHeaders to confirm the transaction receipts.",
data:err$jscomp$0},defer.eventEmitter,defer.reject);else return sub||(sub={unsubscribe:function(){clearInterval(intervalId);clearTimeout(blockHeaderTimeoutId)}}),(existingReceipt?promiEvent.resolve(existingReceipt):_ethereumCall.getTransactionReceipt(result)).catch(function(err){sub.unsubscribe();promiseResolved=!0;utils._fireError({message:"Failed to check for transaction receipt:",data:err},defer.eventEmitter,defer.reject)}).then(async function(receipt){if(!receipt||!receipt.blockHash)throw Error("Receipt missing or blockHash null");
method.extraFormatters&&method.extraFormatters.receiptFormatter&&(receipt=method.extraFormatters.receiptFormatter(receipt));if(0<defer.eventEmitter.listeners("confirmation").length){var block;if(void 0===existingReceipt||0!==confirmationCount){var latestBlock=await _ethereumCall.getBlockByNumber("latest");latestBlock=latestBlock?latestBlock.hash:null;if(isPolling)if(lastBlock){if(block=await _ethereumCall.getBlockByNumber(lastBlock.number+1))lastBlock=block,defer.eventEmitter.emit("confirmation",
confirmationCount,receipt,latestBlock)}else lastBlock=block=await _ethereumCall.getBlockByNumber(receipt.blockNumber),defer.eventEmitter.emit("confirmation",confirmationCount,receipt,latestBlock);else defer.eventEmitter.emit("confirmation",confirmationCount,receipt,latestBlock)}(isPolling&&block||!isPolling)&&confirmationCount++;canUnsubscribe=!1;confirmationCount===method.transactionConfirmationBlocks+1&&(sub.unsubscribe(),defer.eventEmitter.removeAllListeners())}return receipt}).then(async function(receipt){if(isContractDeployment&&
!promiseResolved){if(!receipt.contractAddress){canUnsubscribe&&(sub.unsubscribe(),promiseResolved=!0);utils._fireError(errors.NoContractAddressFoundError(receipt),defer.eventEmitter,defer.reject,null,receipt);return}try{var code=await _ethereumCall.getCode(receipt.contractAddress)}catch(err){}if(!code)return;!0===receipt.status&&hasBytecode||2<code.length?(defer.eventEmitter.emit("receipt",receipt),method.extraFormatters&&method.extraFormatters.contractDeployFormatter?defer.resolve(method.extraFormatters.contractDeployFormatter(receipt)):
defer.resolve(receipt),canUnsubscribe&&defer.eventEmitter.removeAllListeners()):utils._fireError(errors.ContractCodeNotStoredError(receipt),defer.eventEmitter,defer.reject,null,receipt);canUnsubscribe&&sub.unsubscribe();promiseResolved=!0}return receipt}).then(async function(receipt){if(!isContractDeployment&&!promiseResolved){if(receipt.outOfGas||gasProvided&&gasProvided===receipt.gasUsed||!0!==receipt.status&&"0x1"!==receipt.status&&"undefined"!==typeof receipt.status)if(JSON.stringify(receipt,
null,2),!1===receipt.status||"0x0"===receipt.status)try{var revertMessage=null;if(!method.handleRevert||"eth_sendTransaction"!==method.call&&"eth_sendRawTransaction"!==method.call)throw!1;var txReplayOptions=payload.params[0];if("eth_sendRawTransaction"===method.call){var parsedTx=EthersTransactionUtils.parse(payload.params[0]);txReplayOptions=formatters.inputTransactionFormatter({data:parsedTx.data,to:parsedTx.to,from:parsedTx.from,gas:parsedTx.gasLimit.toHexString(),gasPrice:parsedTx.gasPrice.toHexString(),
value:parsedTx.value.toHexString()})}if(revertMessage=await method.getRevertReason(txReplayOptions,receipt.blockNumber))utils._fireError(errors.TransactionRevertInstructionError(revertMessage.reason,revertMessage.signature,receipt),defer.eventEmitter,defer.reject,null,receipt);else throw!1;}catch(error){utils._fireError(errors.TransactionRevertedWithoutReasonError(receipt),defer.eventEmitter,defer.reject,null,receipt)}else utils._fireError(errors.TransactionOutOfGasError(receipt),defer.eventEmitter,
defer.reject,null,receipt);else defer.eventEmitter.emit("receipt",receipt),defer.resolve(receipt),canUnsubscribe&&defer.eventEmitter.removeAllListeners();canUnsubscribe&&sub.unsubscribe();promiseResolved=!0}}).catch(function(){timeoutCount++;isPolling?timeoutCount-1>=method.transactionPollingTimeout&&(sub.unsubscribe(),promiseResolved=!0,utils._fireError(errors.TransactionError("Transaction was not mined within "+method.transactionPollingTimeout+" seconds, please make sure your transaction was properly sent. Be aware that it might still be mined!"),
defer.eventEmitter,defer.reject)):timeoutCount-1>=method.transactionBlockTimeout&&(sub.unsubscribe(),promiseResolved=!0,utils._fireError(errors.TransactionError("Transaction was not mined within "+method.transactionBlockTimeout+" blocks, please make sure your transaction was properly sent. Be aware that it might still be mined!"),defer.eventEmitter,defer.reject))})},startWatching=function(existingReceipt){let blockHeaderArrived=!1;const startInterval=()=>{intervalId=setInterval(checkConfirmation.bind(null,
existingReceipt,!0),method.transactionPollingInterval)};if(!this.requestManager.provider.on)return startInterval();_ethereumCall.subscribe("newBlockHeaders",function(err,blockHeader,sub){blockHeaderArrived=!0;if(err||!blockHeader)return startInterval();checkConfirmation(existingReceipt,!1,err,blockHeader,sub)});blockHeaderTimeoutId=setTimeout(()=>{blockHeaderArrived||startInterval()},1E3*this.blockHeaderTimeout)}.bind(this);_ethereumCall.getTransactionReceipt(result).then(function(receipt){receipt&&
receipt.blockHash?(0<defer.eventEmitter.listeners("confirmation").length&&startWatching(receipt),checkConfirmation(receipt,!1)):promiseResolved||startWatching()}).catch(function(){promiseResolved||startWatching()})};var getWallet=function(from,accounts){return"number"===typeof from?accounts.wallet[from]:from&&"object"===typeof from&&from.address&&from.privateKey?from:accounts.wallet[from.toLowerCase()]};Method.prototype.buildCall=function(){var method$jscomp$0=this,isSendTx="eth_sendTransaction"===
method$jscomp$0.call||"eth_sendRawTransaction"===method$jscomp$0.call,isCall="eth_call"===method$jscomp$0.call,send=function(){var defer=promiEvent(!isSendTx),payload$jscomp$0=method$jscomp$0.toPayload(Array.prototype.slice.call(arguments)),sendTxCallback=function(err,result){if(method$jscomp$0.handleRevert&&isCall&&method$jscomp$0.abiCoder){var reasonData;!err&&method$jscomp$0.isRevertReasonString(result)?reasonData=result.substring(10):err&&err.data&&(reasonData=err.data.substring(10));if(reasonData){err=
method$jscomp$0.abiCoder.decodeParameter("string","0x"+reasonData);utils._fireError(errors.RevertInstructionError(err,"Error(String)"),defer.eventEmitter,defer.reject,payload$jscomp$0.callback,{reason:err,signature:"Error(String)"});return}}try{result=method$jscomp$0.formatOutput(result)}catch(e){err=e}result instanceof Error&&(err=result);if(err)return err.error&&(err=err.error),utils._fireError(err,defer.eventEmitter,defer.reject,payload$jscomp$0.callback);payload$jscomp$0.callback&&payload$jscomp$0.callback(null,
result);isSendTx?(defer.eventEmitter.emit("transactionHash",result),method$jscomp$0._confirmTransaction(defer,result,payload$jscomp$0)):err||defer.resolve(result)},sendSignedTx=function(sign){method$jscomp$0.requestManager.send({...payload$jscomp$0,method:"eth_sendRawTransaction",params:[sign.rawTransaction]},sendTxCallback)},sendRequest=function(payload,method){if(method&&method.accounts&&method.accounts.wallet&&method.accounts.wallet.length){var wallet;if("eth_sendTransaction"===payload.method){var tx=
payload.params[0];if((wallet=getWallet(tx&&"object"===typeof tx?tx.from:null,method.accounts))&&wallet.privateKey){tx=JSON.parse(JSON.stringify(tx));delete tx.from;method.defaultChain&&!tx.chain&&(tx.chain=method.defaultChain);method.defaultHardfork&&!tx.hardfork&&(tx.hardfork=method.defaultHardfork);method.defaultCommon&&!tx.common&&(tx.common=method.defaultCommon);method.accounts.signTransaction(tx,wallet.privateKey).then(sendSignedTx).catch(function(err$jscomp$0){if("function"===typeof defer.eventEmitter.listeners&&
defer.eventEmitter.listeners("error").length){try{defer.eventEmitter.emit("error",err$jscomp$0)}catch(err){}defer.eventEmitter.removeAllListeners();defer.eventEmitter.catch(function(){})}defer.reject(err$jscomp$0)});return}}else if("eth_sign"===payload.method&&(tx=payload.params[1],(wallet=getWallet(payload.params[0],method.accounts))&&wallet.privateKey)){method=method.accounts.sign(tx,wallet.privateKey);payload.callback&&payload.callback(null,method.signature);defer.resolve(method.signature);return}}return method.requestManager.send(payload,
sendTxCallback)};isSendTx&&payload$jscomp$0.params[0]&&"object"===typeof payload$jscomp$0.params[0]&&"undefined"===typeof payload$jscomp$0.params[0].gasPrice&&("undefined"===typeof payload$jscomp$0.params[0].maxPriorityFeePerGas||"undefined"===typeof payload$jscomp$0.params[0].maxFeePerGas)?_handleTxPricing(method$jscomp$0,payload$jscomp$0.params[0]).then(txPricing=>{void 0!==txPricing.gasPrice?payload$jscomp$0.params[0].gasPrice=txPricing.gasPrice:void 0!==txPricing.maxPriorityFeePerGas&&void 0!==
txPricing.maxFeePerGas&&(payload$jscomp$0.params[0].maxPriorityFeePerGas=txPricing.maxPriorityFeePerGas,payload$jscomp$0.params[0].maxFeePerGas=txPricing.maxFeePerGas);isSendTx&&setTimeout(()=>{defer.eventEmitter.emit("sending",payload$jscomp$0)},0);sendRequest(payload$jscomp$0,method$jscomp$0)}):(isSendTx&&setTimeout(()=>{defer.eventEmitter.emit("sending",payload$jscomp$0)},0),sendRequest(payload$jscomp$0,method$jscomp$0));isSendTx&&setTimeout(()=>{defer.eventEmitter.emit("sent",payload$jscomp$0)},
0);return defer.eventEmitter};send.method=method$jscomp$0;send.request=this.request.bind(this);return send};Method.prototype.getRevertReason=function(txOptions,blockNumber){var self=this;return new Promise(function(resolve,reject){(new Method({name:"call",call:"eth_call",params:2,abiCoder:self.abiCoder,handleRevert:!0})).createFunction(self.requestManager)(txOptions,utils.numberToHex(blockNumber)).then(function(){resolve(!1)}).catch(function(error){error.reason?resolve({reason:error.reason,signature:error.signature}):
reject(error)})})};Method.prototype.isRevertReasonString=function(data){return"string"===typeof data&&4===(data.length-2)/2%32&&"0x08c379a0"===data.substring(0,10)};Method.prototype.request=function(){var payload=this.toPayload(Array.prototype.slice.call(arguments));payload.format=this.formatOutput.bind(this);return payload};module.exports=Method}
//# sourceMappingURL=module$node_modules$web3_core_method$lib$index.js.map
