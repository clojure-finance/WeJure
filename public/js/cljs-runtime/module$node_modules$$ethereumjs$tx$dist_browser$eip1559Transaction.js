shadow$provide.module$node_modules$$ethereumjs$tx$dist_browser$eip1559Transaction=function(global,require,module,exports){var Buffer=require("module$node_modules$buffer$index").Buffer;"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d$jscomp$0,b$jscomp$0){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])};return extendStatics(d$jscomp$0,
b$jscomp$0)};return function(d,b){function __(){this.constructor=d}if("function"!==typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),__assign=this&&this.__assign||function(){__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p])}return t};return __assign.apply(this,
arguments)},__read=this&&this.__read||function(o,n){var m="function"===typeof Symbol&&o[Symbol.iterator];if(!m)return o;o=m.call(o);var r,ar=[];try{for(;(void 0===n||0<n--)&&!(r=o.next()).done;)ar.push(r.value)}catch(error){var e={error}}finally{try{r&&!r.done&&(m=o["return"])&&m.call(o)}finally{if(e)throw e.error;}}return ar};Object.defineProperty(exports,"__esModule",{value:!0});var ethereumjs_util_1=require("module$node_modules$ethereumjs_util$dist_browser$index");global=require("module$node_modules$$ethereumjs$tx$dist_browser$baseTransaction");
var types_1=require("module$node_modules$$ethereumjs$tx$dist_browser$types"),util_1=require("module$node_modules$$ethereumjs$tx$dist_browser$util"),TRANSACTION_TYPE_BUFFER=Buffer.from((2).toString(16).padStart(2,"0"),"hex");require=function(_super){function FeeMarketEIP1559Transaction(txData,opts){void 0===opts&&(opts={});var _a,_b,_this=_super.call(this,__assign(__assign({},txData),{type:2}))||this;_this.DEFAULT_HARDFORK="london";var accessList=txData.accessList,maxFeePerGas=txData.maxFeePerGas,
maxPriorityFeePerGas=txData.maxPriorityFeePerGas;_this.common=_this._getCommon(opts.common,txData.chainId);_this.chainId=_this.common.chainIdBN();if(!_this.common.isActivatedEIP(1559))throw Error("EIP-1559 not enabled on Common");_this.activeCapabilities=_this.activeCapabilities.concat([1559,2718,2930]);txData=util_1.AccessLists.getAccessListData(null!==accessList&&void 0!==accessList?accessList:[]);_this.accessList=txData.accessList;_this.AccessListJSON=txData.AccessListJSON;util_1.AccessLists.verifyAccessList(_this.accessList);
_this.maxFeePerGas=new ethereumjs_util_1.BN((0,ethereumjs_util_1.toBuffer)(""===maxFeePerGas?"0x":maxFeePerGas));_this.maxPriorityFeePerGas=new ethereumjs_util_1.BN((0,ethereumjs_util_1.toBuffer)(""===maxPriorityFeePerGas?"0x":maxPriorityFeePerGas));_this._validateCannotExceedMaxInteger({maxFeePerGas:_this.maxFeePerGas,maxPriorityFeePerGas:_this.maxPriorityFeePerGas});if(_this.gasLimit.mul(_this.maxFeePerGas).gt(ethereumjs_util_1.MAX_INTEGER))throw opts=_this._errorMsg("gasLimit * maxFeePerGas cannot exceed MAX_INTEGER (2^256-1)"),
Error(opts);if(_this.maxFeePerGas.lt(_this.maxPriorityFeePerGas))throw opts=_this._errorMsg("maxFeePerGas cannot be less than maxPriorityFeePerGas (The total must be the larger of the two)"),Error(opts);if(_this.v&&!_this.v.eqn(0)&&!_this.v.eqn(1))throw opts=_this._errorMsg("The y-parity of the transaction should either be 0 or 1"),Error(opts);if(_this.common.gteHardfork("homestead")&&(null===(_a=_this.s)||void 0===_a?0:_a.gt(types_1.N_DIV_2)))throw opts=_this._errorMsg("Invalid Signature: s-values greater than secp256k1n/2 are considered invalid"),
Error(opts);(null!==(_b=null===opts||void 0===opts?void 0:opts.freeze)&&void 0!==_b?_b:1)&&Object.freeze(_this);return _this}__extends(FeeMarketEIP1559Transaction,_super);Object.defineProperty(FeeMarketEIP1559Transaction.prototype,"senderR",{get:function(){return this.r},enumerable:!1,configurable:!0});Object.defineProperty(FeeMarketEIP1559Transaction.prototype,"senderS",{get:function(){return this.s},enumerable:!1,configurable:!0});Object.defineProperty(FeeMarketEIP1559Transaction.prototype,"yParity",
{get:function(){return this.v},enumerable:!1,configurable:!0});FeeMarketEIP1559Transaction.fromTxData=function(txData,opts){void 0===opts&&(opts={});return new FeeMarketEIP1559Transaction(txData,opts)};FeeMarketEIP1559Transaction.fromSerializedTx=function(serialized,opts){void 0===opts&&(opts={});if(!serialized.slice(0,1).equals(TRANSACTION_TYPE_BUFFER))throw Error("Invalid serialized tx input: not an EIP-1559 transaction (wrong tx type, expected: ".concat(2,", received: ").concat(serialized.slice(0,
1).toString("hex")));serialized=ethereumjs_util_1.rlp.decode(serialized.slice(1));if(!Array.isArray(serialized))throw Error("Invalid serialized tx input: must be array");return FeeMarketEIP1559Transaction.fromValuesArray(serialized,opts)};FeeMarketEIP1559Transaction.fromRlpSerializedTx=function(serialized,opts){void 0===opts&&(opts={});return FeeMarketEIP1559Transaction.fromSerializedTx(serialized,opts)};FeeMarketEIP1559Transaction.fromValuesArray=function(values,opts){void 0===opts&&(opts={});if(9!==
values.length&&12!==values.length)throw Error("Invalid EIP-1559 transaction. Only expecting 9 values (for unsigned tx) or 12 values (for signed tx).");var _a=__read(values,12);values=_a[0];var nonce=_a[1],maxPriorityFeePerGas=_a[2],maxFeePerGas=_a[3],gasLimit=_a[4],to=_a[5],value=_a[6],data=_a[7],accessList=_a[8],v=_a[9],r=_a[10];_a=_a[11];(0,ethereumjs_util_1.validateNoLeadingZeroes)({nonce,maxPriorityFeePerGas,maxFeePerGas,gasLimit,value,v,r,s:_a});return new FeeMarketEIP1559Transaction({chainId:new ethereumjs_util_1.BN(values),
nonce,maxPriorityFeePerGas,maxFeePerGas,gasLimit,to,value,data,accessList:null!==accessList&&void 0!==accessList?accessList:[],v:void 0!==v?new ethereumjs_util_1.BN(v):void 0,r,s:_a},opts)};FeeMarketEIP1559Transaction.prototype.getDataFee=function(){if(this.cache.dataFee&&this.cache.dataFee.hardfork===this.common.hardfork())return this.cache.dataFee.value;var cost=_super.prototype.getDataFee.call(this);cost.iaddn(util_1.AccessLists.getDataFeeEIP2930(this.accessList,this.common));Object.isFrozen(this)&&
(this.cache.dataFee={value:cost,hardfork:this.common.hardfork()});return cost};FeeMarketEIP1559Transaction.prototype.getUpfrontCost=function(baseFee){void 0===baseFee&&(baseFee=new ethereumjs_util_1.BN(0));baseFee=ethereumjs_util_1.BN.min(this.maxPriorityFeePerGas,this.maxFeePerGas.sub(baseFee)).add(baseFee);return this.gasLimit.mul(baseFee).add(this.value)};FeeMarketEIP1559Transaction.prototype.raw=function(){return[(0,ethereumjs_util_1.bnToUnpaddedBuffer)(this.chainId),(0,ethereumjs_util_1.bnToUnpaddedBuffer)(this.nonce),
(0,ethereumjs_util_1.bnToUnpaddedBuffer)(this.maxPriorityFeePerGas),(0,ethereumjs_util_1.bnToUnpaddedBuffer)(this.maxFeePerGas),(0,ethereumjs_util_1.bnToUnpaddedBuffer)(this.gasLimit),void 0!==this.to?this.to.buf:Buffer.from([]),(0,ethereumjs_util_1.bnToUnpaddedBuffer)(this.value),this.data,this.accessList,void 0!==this.v?(0,ethereumjs_util_1.bnToUnpaddedBuffer)(this.v):Buffer.from([]),void 0!==this.r?(0,ethereumjs_util_1.bnToUnpaddedBuffer)(this.r):Buffer.from([]),void 0!==this.s?(0,ethereumjs_util_1.bnToUnpaddedBuffer)(this.s):
Buffer.from([])]};FeeMarketEIP1559Transaction.prototype.serialize=function(){var base=this.raw();return Buffer.concat([TRANSACTION_TYPE_BUFFER,ethereumjs_util_1.rlp.encode(base)])};FeeMarketEIP1559Transaction.prototype.getMessageToSign=function(hashMessage){void 0===hashMessage&&(hashMessage=!0);var base=this.raw().slice(0,9);base=Buffer.concat([TRANSACTION_TYPE_BUFFER,ethereumjs_util_1.rlp.encode(base)]);return hashMessage?(0,ethereumjs_util_1.keccak256)(base):base};FeeMarketEIP1559Transaction.prototype.hash=
function(){if(!this.isSigned()){var msg=this._errorMsg("Cannot call hash method if transaction is not signed");throw Error(msg);}return Object.isFrozen(this)?(this.cache.hash||(this.cache.hash=(0,ethereumjs_util_1.keccak256)(this.serialize())),this.cache.hash):(0,ethereumjs_util_1.keccak256)(this.serialize())};FeeMarketEIP1559Transaction.prototype.getMessageToVerifySignature=function(){return this.getMessageToSign()};FeeMarketEIP1559Transaction.prototype.getSenderPublicKey=function(){var _a;if(!this.isSigned()){var msg=
this._errorMsg("Cannot call this method if transaction is not signed");throw Error(msg);}msg=this.getMessageToVerifySignature();if(this.common.gteHardfork("homestead")&&(null===(_a=this.s)||void 0===_a?0:_a.gt(types_1.N_DIV_2)))throw msg=this._errorMsg("Invalid Signature: s-values greater than secp256k1n/2 are considered invalid"),Error(msg);_a=this.v;var r=this.r,s=this.s;try{return(0,ethereumjs_util_1.ecrecover)(msg,_a.addn(27),(0,ethereumjs_util_1.bnToUnpaddedBuffer)(r),(0,ethereumjs_util_1.bnToUnpaddedBuffer)(s))}catch(e){throw msg=
this._errorMsg("Invalid Signature"),Error(msg);}};FeeMarketEIP1559Transaction.prototype._processSignature=function(v,r,s){var opts={common:this.common};return FeeMarketEIP1559Transaction.fromTxData({chainId:this.chainId,nonce:this.nonce,maxPriorityFeePerGas:this.maxPriorityFeePerGas,maxFeePerGas:this.maxFeePerGas,gasLimit:this.gasLimit,to:this.to,value:this.value,data:this.data,accessList:this.accessList,v:new ethereumjs_util_1.BN(v-27),r:new ethereumjs_util_1.BN(r),s:new ethereumjs_util_1.BN(s)},
opts)};FeeMarketEIP1559Transaction.prototype.toJSON=function(){var accessListJSON=util_1.AccessLists.getAccessListJSON(this.accessList);return{chainId:(0,ethereumjs_util_1.bnToHex)(this.chainId),nonce:(0,ethereumjs_util_1.bnToHex)(this.nonce),maxPriorityFeePerGas:(0,ethereumjs_util_1.bnToHex)(this.maxPriorityFeePerGas),maxFeePerGas:(0,ethereumjs_util_1.bnToHex)(this.maxFeePerGas),gasLimit:(0,ethereumjs_util_1.bnToHex)(this.gasLimit),to:void 0!==this.to?this.to.toString():void 0,value:(0,ethereumjs_util_1.bnToHex)(this.value),
data:"0x"+this.data.toString("hex"),accessList:accessListJSON,v:void 0!==this.v?(0,ethereumjs_util_1.bnToHex)(this.v):void 0,r:void 0!==this.r?(0,ethereumjs_util_1.bnToHex)(this.r):void 0,s:void 0!==this.s?(0,ethereumjs_util_1.bnToHex)(this.s):void 0}};FeeMarketEIP1559Transaction.prototype.errorStr=function(){var errorStr=this._getSharedErrorPostfix();return errorStr+=" maxFeePerGas\x3d".concat(this.maxFeePerGas," maxPriorityFeePerGas\x3d").concat(this.maxPriorityFeePerGas)};FeeMarketEIP1559Transaction.prototype._errorMsg=
function(msg){return"".concat(msg," (").concat(this.errorStr(),")")};return FeeMarketEIP1559Transaction}(global.BaseTransaction);exports.default=require}
//# sourceMappingURL=module$node_modules$$ethereumjs$tx$dist_browser$eip1559Transaction.js.map
