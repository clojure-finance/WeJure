{
"version":3,
"file":"module$node_modules$stream_http$lib$request.js",
"lineCount":11,
"mappings":"AAAAA,cAAA,CAAA,2CAAA,CAAgE,QAAQ,CAACC,MAAD,CAAQC,OAAR,CAAgBC,MAAhB,CAAuBC,OAAvB,CAAgC,CACxG,IAAIC,QAAUH,OAAA,CAAQ,qCAAR,CAAd,CACII,OAASJ,OAAA,CAAQ,kCAAR,CAAkBI,CAAAA,MAD/B,CAEIC,WAAaL,OAAA,CAAQ,gDAAR,CACbM,QAAAA,CAAWN,OAAA,CAAQ,+CAAR,CACf,KAAIO,kBAAWP,OAAA,CAAQ,8CAAR,CAAf,CACIQ,OAASR,OAAA,CAAQ,sDAAR,CADb,CAEIS;AAAgBT,OAAA,CAAQ,0CAAR,CAFpB,CAIIU,gBAAkBH,iBAASG,CAAAA,eAJ/B,CAKIC,QAAUJ,iBAASK,CAAAA,WAkBnBC,QAAAA,CAAgBZ,MAAOC,CAAAA,OAAvBW,CAAiCC,QAAS,CAACC,IAAD,CAAO,CACpD,IAAIC,KAAO,IACXR,OAAOS,CAAAA,QAASC,CAAAA,IAAhB,CAAqBF,IAArB,CAEAA,KAAKG,CAAAA,KAAL,CAAaJ,IACbC,KAAKI,CAAAA,KAAL,CAAa,EACbJ,KAAKK,CAAAA,QAAL,CAAgB,EACZN,KAAKO,CAAAA,IAAT,EACCN,IAAKO,CAAAA,SAAL,CAAe,eAAf,CAAgC,QAAhC,CAAiEC,CAAtB,IAAIpB,MAAJ,CAAWW,IAAKO,CAAAA,IAAhB,CAAsBE,EAAAA,QAAtB,CAA+B,QAA/B,CAA3C,CACDC,OAAOC,CAAAA,IAAP,CAAYX,IAAKY,CAAAA,OAAjB,CAA0BC,CAAAA,OAA1B,CAAkC,QAAS,CAACC,IAAD,CAAO,CACjDb,IAAKO,CAAAA,SAAL,CAAeM,IAAf,CAAqBd,IAAKY,CAAAA,OAAL,CAAaE,IAAb,CAArB,CADiD,CAAlD,CAIA,KACIC,SAAW,CAAA,CACf,IAAkB,eAAlB,GAAIf,IAAKgB,CAAAA,IAAT,EAAsC,gBAAtC;AAA0DhB,IAA1D,EAAkE,CAACV,UAAW2B,CAAAA,eAA9E,CAAgG,CAE/FF,QAAA,CAAW,CAAA,CACX,KAAAG,aAAe,CAAA,CAHgF,CAAhG,IAIO,IAAkB,kBAAlB,GAAIlB,IAAKgB,CAAAA,IAAT,CAGNE,YAAA,CAAe,CAAA,CAHT,KAIA,IAAkB,0BAAlB,GAAIlB,IAAKgB,CAAAA,IAAT,CAENE,YAAA,CAAe,CAAC5B,UAAW6B,CAAAA,gBAFrB,KAGA,CAAA,GAAKnB,IAAKgB,CAAAA,IAAV,EAAgC,SAAhC,GAAkBhB,IAAKgB,CAAAA,IAAvB,EAA2D,aAA3D,GAA6ChB,IAAKgB,CAAAA,IAAlD,CAIN,KAAUI,MAAJ,CAAU,6BAAV,CAAN,CAFAF,YAAA,CAAe,CAAA,CAFT,CAMPjB,IAAKoB,CAAAA,KAAL,CA/CI/B,UAAWgC,CAAAA,KAAf,EA+CsCP,QA/CtC,CACQ,OADR,CAEWzB,UAAWiC,CAAAA,qBAAf,CACC,yBADD,CAEIjC,UAAWkC,CAAAA,QAAf,CACC,WADD,CAEIlC,UAAWmC,CAAAA,WAAf,EAyCiBP,YAzCjB;AACC,aADD,CAEI5B,UAAWoC,CAAAA,OAAf,EAuCiBR,YAvCjB,CACC,cADD,CAGC,MAqCRjB,KAAK0B,CAAAA,WAAL,CAAmB,IAEnB1B,KAAK2B,CAAAA,EAAL,CAAQ,QAAR,CAAkB,QAAS,EAAG,CAC7B3B,IAAK4B,CAAAA,SAAL,EAD6B,CAA9B,CAnCoD,CAwCrDtC,QAAA,CAASO,OAAT,CAAwBL,MAAOS,CAAAA,QAA/B,CAEAJ,QAAcgC,CAAAA,SAAUtB,CAAAA,SAAxB,CAAoCuB,QAAS,CAACjB,IAAD,CAAOkB,KAAP,CAAc,CAE1D,IAAIC,UAAYnB,IAAKoB,CAAAA,WAAL,EAIyB,EAAC,CAA1C,GAAIC,aAAcC,CAAAA,OAAd,CAAsBH,SAAtB,CAAJ,GALWhC,IAQNK,CAAAA,QAAL,CAAc2B,SAAd,CAHA,CAG2B,CACpBnB,IADoB,CAEnBkB,KAFmB,CAH3B,CAN0D,CAe3DlC,QAAcgC,CAAAA,SAAUO,CAAAA,SAAxB,CAAoCC,QAAS,CAACxB,IAAD,CAAO,CAEnD,MAAA,CADIyB,IACJ,CADa,IAAKjC,CAAAA,QAAL,CAAcQ,IAAKoB,CAAAA,WAAL,EAAd,CACb,EACQK,IAAOP,CAAAA,KADf,CAEO,IAJ4C,CAOpDlC,QAAcgC,CAAAA,SAAUU,CAAAA,YAAxB,CAAuCC,QAAS,CAAC3B,IAAD,CAAO,CAEtD,OADWb,IACCK,CAAAA,QAAL,CAAcQ,IAAKoB,CAAAA,WAAL,EAAd,CAF+C,CAKvDpC;OAAcgC,CAAAA,SAAUD,CAAAA,SAAxB,CAAoCa,QAAS,EAAG,CAC/C,IAAIzC,KAAO,IAEX,IAAS0C,CAAL1C,IAAK0C,CAAAA,UAAT,CAAA,CAEA,IAAI3C,KAAOC,IAAKG,CAAAA,KAAhB,CAEIwC,WAAa3C,IAAKK,CAAAA,QAFtB,CAGIuC,KAAO,IACS,MAApB,GAAI7C,IAAK8C,CAAAA,MAAT,EAA6C,MAA7C,GAA6B9C,IAAK8C,CAAAA,MAAlC,GAEED,IAFF,CACKvD,UAAWmC,CAAAA,WAAf,CACQ/B,aAAA,CAAcL,MAAO0D,CAAAA,MAAP,CAAc9C,IAAKI,CAAAA,KAAnB,CAAd,CADR,CAEWf,UAAW0D,CAAAA,eAAf,CACC,IAAIhE,MAAOiE,CAAAA,IAAX,CAAgBhD,IAAKI,CAAAA,KAAM6C,CAAAA,GAAX,CAAe,QAAS,CAACC,MAAD,CAAS,CACvD,MAAOzD,cAAA,CAAcyD,MAAd,CADgD,CAAjC,CAAhB,CAEH,CACHC,KAAyCpB,CAAlCY,UAAA,CAAW,cAAX,CAAkCZ,EAAJ,EAAIA,EAAAA,KAAzCoB,EAAkD,EAD/C,CAFG,CADD,CAQC/D,MAAO0D,CAAAA,MAAP,CAAc9C,IAAKI,CAAAA,KAAnB,CAA0BI,CAAAA,QAA1B,EAXT,CAgBA,KAAI4C,YAAc,EAClB3C,OAAOC,CAAAA,IAAP,CAAYiC,UAAZ,CAAwB/B,CAAAA,OAAxB,CAAgC,QAAS,CAACyC,OAAD,CAAU,CAClD,IAAIxC;AAAO8B,UAAA,CAAWU,OAAX,CAAoBxC,CAAAA,IAC3BkB,QAAAA,CAAQY,UAAA,CAAWU,OAAX,CAAoBtB,CAAAA,KAC5BuB,MAAMC,CAAAA,OAAN,CAAcxB,OAAd,CAAJ,CACCA,OAAMnB,CAAAA,OAAN,CAAc,QAAS,CAAC4C,CAAD,CAAI,CAC1BJ,WAAYK,CAAAA,IAAZ,CAAiB,CAAC5C,IAAD,CAAO2C,CAAP,CAAjB,CAD0B,CAA3B,CADD,CAKCJ,WAAYK,CAAAA,IAAZ,CAAiB,CAAC5C,IAAD,CAAOkB,OAAP,CAAjB,CARiD,CAAnD,CAYA,IAAmB,OAAnB,GAAI/B,IAAKoB,CAAAA,KAAT,CAA4B,CAC3B,IAAIsC,OAAS,IAEb,IAAIrE,UAAW2B,CAAAA,eAAf,CAAgC,CAC/B,IAAI2C,WAAa,IAAIC,eACrBF,OAAA,CAASC,UAAWD,CAAAA,MACpB1D,KAAK6D,CAAAA,qBAAL,CAA6BF,UAEzB,iBAAJ,EAAwB5D,KAAxB,EAAwD,CAAxD,GAAgCA,IAAK+D,CAAAA,cAArC,GACC9D,IAAK0B,CAAAA,WADN,CACoB3C,MAAOgF,CAAAA,UAAP,CAAkB,QAAS,EAAG,CAChD/D,IAAKgE,CAAAA,IAAL,CAAU,gBAAV,CACIhE,KAAK6D,CAAAA,qBAAT,EACC7D,IAAK6D,CAAAA,qBAAsBI,CAAAA,KAA3B,EAH+C,CAA9B;AAIhBlE,IAAK+D,CAAAA,cAJW,CADpB,CAL+B,CAchC/E,MAAOsC,CAAAA,KAAP,CAAarB,IAAKG,CAAAA,KAAM+D,CAAAA,GAAxB,CAA6B,CAC5BrB,OAAQ7C,IAAKG,CAAAA,KAAM0C,CAAAA,MADS,CAE5BlC,QAASyC,WAFmB,CAG5BR,KAAMA,IAANA,EAAcuB,IAAAA,EAHc,CAI5BpD,KAAM,MAJsB,CAK5BqD,YAAarE,IAAKsE,CAAAA,eAAL,CAAuB,SAAvB,CAAmC,aALpB,CAMpBX,MANoB,CAA7B,CAOGY,CAAAA,IAPH,CAOQ,QAAS,CAAC/E,QAAD,CAAW,CAC3BS,IAAKuE,CAAAA,cAAL,CAAsBhF,QACtBS,KAAKwE,CAAAA,QAAL,EAF2B,CAP5B,CAUG,QAAS,CAACC,MAAD,CAAS,CACpB1F,MAAO2F,CAAAA,YAAP,CAAoB1E,IAAK0B,CAAAA,WAAzB,CACK1B,KAAK0C,CAAAA,UAAV,EACC1C,IAAKgE,CAAAA,IAAL,CAAU,OAAV,CAAmBS,MAAnB,CAHmB,CAVrB,CAjB2B,CAA5B,IAgCO,CACN,IAAIE,IAAM3E,IAAK4E,CAAAA,IAAXD,CAAkB,IAAI5F,MAAO8F,CAAAA,cACjC,IAAI,CACHF,GAAIG,CAAAA,IAAJ,CAAS9E,IAAKG,CAAAA,KAAM0C,CAAAA,MAApB,CAA4B7C,IAAKG,CAAAA,KAAM+D,CAAAA,GAAvC,CAA4C,CAAA,CAA5C,CADG,CAEF,MAAOa,GAAP,CAAY,CACb5F,OAAQ6F,CAAAA,QAAR,CAAiB,QAAS,EAAG,CAC5BhF,IAAKgE,CAAAA,IAAL,CAAU,OAAV;AAAmBe,GAAnB,CAD4B,CAA7B,CAGA,OAJa,CAQV,cAAJ,EAAsBJ,IAAtB,GACCA,GAAIM,CAAAA,YADL,CACoBjF,IAAKoB,CAAAA,KAAM8D,CAAAA,KAAX,CAAiB,GAAjB,CAAA,CAAsB,CAAtB,CADpB,CAGI,kBAAJ,EAAyBP,IAAzB,GACCA,GAAIN,CAAAA,eADL,CACuB,CAAC,CAACtE,IAAKsE,CAAAA,eAD9B,CAGmB,OAAnB,GAAIrE,IAAKoB,CAAAA,KAAT,EAA6B,kBAA7B,EAAmDuD,IAAnD,EACCA,GAAIzD,CAAAA,gBAAJ,CAAqB,uCAArB,CAEG,iBAAJ,EAAwBnB,KAAxB,GACC4E,GAAIQ,CAAAA,OACJ,CADcpF,IAAK+D,CAAAA,cACnB,CAAAa,GAAIS,CAAAA,SAAJ,CAAgBC,QAAS,EAAG,CAC3BrF,IAAKgE,CAAAA,IAAL,CAAU,gBAAV,CAD2B,CAF7B,CAOAZ,YAAYxC,CAAAA,OAAZ,CAAoB,QAAS,CAAC0B,MAAD,CAAS,CACrCqC,GAAIW,CAAAA,gBAAJ,CAAqBhD,MAAA,CAAO,CAAP,CAArB,CAAgCA,MAAA,CAAO,CAAP,CAAhC,CADqC,CAAtC,CAIAtC,KAAKuF,CAAAA,SAAL,CAAiB,IACjBZ,IAAIa,CAAAA,kBAAJ,CAAyBC,QAAS,EAAG,CACpC,OAAQd,GAAIe,CAAAA,UAAZ,EACC,KAAK/F,OAAQgG,CAAAA,OAAb,CACA,KAAKhG,OAAQiG,CAAAA,IAAb,CACC5F,IAAK6F,CAAAA,cAAL,EAHF,CADoC,CAUlB;yBAAnB,GAAI7F,IAAKoB,CAAAA,KAAT,GACCuD,GAAImB,CAAAA,UADL,CACkBC,QAAS,EAAG,CAC5B/F,IAAK6F,CAAAA,cAAL,EAD4B,CAD9B,CAMAlB,IAAIqB,CAAAA,OAAJ,CAAcC,QAAS,EAAG,CACrBjG,IAAK0C,CAAAA,UAAT,EAEA1C,IAAKgE,CAAAA,IAAL,CAAU,OAAV,CAAuB7C,KAAJ,CAAU,WAAV,CAAnB,CAHyB,CAM1B,IAAI,CACHwD,GAAIuB,CAAAA,IAAJ,CAAStD,IAAT,CADG,CAEF,MAAOmC,GAAP,CAAY,CACb5F,OAAQ6F,CAAAA,QAAR,CAAiB,QAAS,EAAG,CAC5BhF,IAAKgE,CAAAA,IAAL,CAAU,OAAV,CAAmBe,GAAnB,CAD4B,CAA7B,CADa,CAzDR,CAnEP,CAH+C,CAsJhDlF,QAAcgC,CAAAA,SAAUgE,CAAAA,cAAxB,CAAyCM,QAAS,EAAG,CARpD,GAAI,CACH,IAAIC,OAQMpG,IAEW4E,CAAAA,IAVJwB,CAAAA,MACjB,KAAA,yBAAmB,IAAnB,GAAQA,MAAR,EAAsC,CAAtC,GAA2BA,MAFxB,CAGF,MAAOC,CAAP,CAAU,CACX,wBAAA,CAAO,CAAA,CADI,CAQP,wBAAL,EAAoC3D,CAFzB1C,IAEyB0C,CAAAA,UAApC,GAFW1C,IAKDuF,CAAAA,SAGV,EARWvF,IAMLwE,CAAAA,QAAL,EAED;AARWxE,IAQNuF,CAAAA,SAAUM,CAAAA,cAAf,EANA,CAHoD,CAYrDhG,QAAcgC,CAAAA,SAAU2C,CAAAA,QAAxB,CAAmC8B,QAAS,EAAG,CAC9C,IAAItG,KAAO,IAEPA,KAAK0C,CAAAA,UAAT,GAGA1C,IAAKuF,CAAAA,SAKL,CALiB,IAAI7F,eAAJ,CAAoBM,IAAK4E,CAAAA,IAAzB,CAA+B5E,IAAKuE,CAAAA,cAApC,CAAoDvE,IAAKoB,CAAAA,KAAzD,CAAgEpB,IAAK0B,CAAAA,WAArE,CAKjB,CAJA1B,IAAKuF,CAAAA,SAAU5D,CAAAA,EAAf,CAAkB,OAAlB,CAA2B,QAAQ,CAACoD,GAAD,CAAM,CACxC/E,IAAKgE,CAAAA,IAAL,CAAU,OAAV,CAAmBe,GAAnB,CADwC,CAAzC,CAIA,CAAA/E,IAAKgE,CAAAA,IAAL,CAAU,UAAV,CAAsBhE,IAAKuF,CAAAA,SAA3B,CARA,CAH8C,CAc/C1F,QAAcgC,CAAAA,SAAU0E,CAAAA,MAAxB,CAAiCC,QAAS,CAACC,KAAD,CAAQC,QAAR,CAAkBC,EAAlB,CAAsB,CACpD3G,IAENI,CAAAA,KAAMqD,CAAAA,IAAX,CAAgBgD,KAAhB,CACAE,GAAA,EAJ+D,CAOhE9G,QAAcgC,CAAAA,SAAUoC,CAAAA,KAAxB,CAAgCpE,OAAcgC,CAAAA,SAAU+E,CAAAA,OAAxD,CAAkEC,QAAS,EAAG,CAClE7G,IACN0C,CAAAA,UAAL,CAAkB,CAAA,CAClB3D,OAAO2F,CAAAA,YAAP,CAFW1E,IAEc0B,CAAAA,WAAzB,CAFW1B;IAGFuF,CAAAA,SAAT,GAHWvF,IAILuF,CAAAA,SAAU7C,CAAAA,UADhB,CAC6B,CAAA,CAD7B,CAHW1C,KAKF4E,CAAAA,IAAT,CALW5E,IAML4E,CAAAA,IAAKX,CAAAA,KAAV,EADD,CALWjE,IAOG6D,CAAAA,qBAFd,EALW7D,IAQL6D,CAAAA,qBAAsBI,CAAAA,KAA3B,EAT4E,CAY9EpE,QAAcgC,CAAAA,SAAUiF,CAAAA,GAAxB,CAA8BC,QAAS,CAACC,IAAD,CAAON,QAAP,CAAiBC,EAAjB,CAAqB,CAEvC,UAApB,GAAI,MAAOK,KAAX,GACCL,EACA,CADKK,IACL,CAAAA,IAAA,CAAO7C,IAAAA,EAFR,CAKA3E,OAAOS,CAAAA,QAAS4B,CAAAA,SAAUiF,CAAAA,GAAI5G,CAAAA,IAA9B,CANWF,IAMX,CAAyCgH,IAAzC,CAA+CN,QAA/C,CAAyDC,EAAzD,CAP2D,CAU5D9G,QAAcgC,CAAAA,SAAUoF,CAAAA,YAAxB,CAAuCC,QAAS,EAAG,EACnDrH,QAAcgC,CAAAA,SAAUkC,CAAAA,UAAxB,CAAqCoD,QAAS,EAAG,EACjDtH,QAAcgC,CAAAA,SAAUuF,CAAAA,UAAxB,CAAqCC,QAAS,EAAG,EACjDxH,QAAcgC,CAAAA,SAAUyF,CAAAA,kBAAxB,CAA6CC,QAAS,EAAG,EAGzD,KAAIrF,cAAgB,8NAAA,CAAA,KAAA,CAAA,GAAA,CApToF;",
"sources":["node_modules/stream-http/lib/request.js"],
"sourcesContent":["shadow$provide[\"module$node_modules$stream_http$lib$request\"] = function(global,require,module,exports) {\nvar process = require('process');\nvar Buffer = require('buffer').Buffer;\nvar capability = require('./capability')\nvar inherits = require('inherits')\nvar response = require('./response')\nvar stream = require('readable-stream')\nvar toArrayBuffer = require('to-arraybuffer')\n\nvar IncomingMessage = response.IncomingMessage\nvar rStates = response.readyStates\n\nfunction decideMode (preferBinary, useFetch) {\n\tif (capability.fetch && useFetch) {\n\t\treturn 'fetch'\n\t} else if (capability.mozchunkedarraybuffer) {\n\t\treturn 'moz-chunked-arraybuffer'\n\t} else if (capability.msstream) {\n\t\treturn 'ms-stream'\n\t} else if (capability.arraybuffer && preferBinary) {\n\t\treturn 'arraybuffer'\n\t} else if (capability.vbArray && preferBinary) {\n\t\treturn 'text:vbarray'\n\t} else {\n\t\treturn 'text'\n\t}\n}\n\nvar ClientRequest = module.exports = function (opts) {\n\tvar self = this\n\tstream.Writable.call(self)\n\n\tself._opts = opts\n\tself._body = []\n\tself._headers = {}\n\tif (opts.auth)\n\t\tself.setHeader('Authorization', 'Basic ' + new Buffer(opts.auth).toString('base64'))\n\tObject.keys(opts.headers).forEach(function (name) {\n\t\tself.setHeader(name, opts.headers[name])\n\t})\n\n\tvar preferBinary\n\tvar useFetch = true\n\tif (opts.mode === 'disable-fetch' || ('requestTimeout' in opts && !capability.abortController)) {\n\t\t// If the use of XHR should be preferred. Not typically needed.\n\t\tuseFetch = false\n\t\tpreferBinary = true\n\t} else if (opts.mode === 'prefer-streaming') {\n\t\t// If streaming is a high priority but binary compatibility and\n\t\t// the accuracy of the 'content-type' header aren't\n\t\tpreferBinary = false\n\t} else if (opts.mode === 'allow-wrong-content-type') {\n\t\t// If streaming is more important than preserving the 'content-type' header\n\t\tpreferBinary = !capability.overrideMimeType\n\t} else if (!opts.mode || opts.mode === 'default' || opts.mode === 'prefer-fast') {\n\t\t// Use binary if text streaming may corrupt data or the content-type header, or for speed\n\t\tpreferBinary = true\n\t} else {\n\t\tthrow new Error('Invalid value for opts.mode')\n\t}\n\tself._mode = decideMode(preferBinary, useFetch)\n\tself._fetchTimer = null\n\n\tself.on('finish', function () {\n\t\tself._onFinish()\n\t})\n}\n\ninherits(ClientRequest, stream.Writable)\n\nClientRequest.prototype.setHeader = function (name, value) {\n\tvar self = this\n\tvar lowerName = name.toLowerCase()\n\t// This check is not necessary, but it prevents warnings from browsers about setting unsafe\n\t// headers. To be honest I'm not entirely sure hiding these warnings is a good thing, but\n\t// http-browserify did it, so I will too.\n\tif (unsafeHeaders.indexOf(lowerName) !== -1)\n\t\treturn\n\n\tself._headers[lowerName] = {\n\t\tname: name,\n\t\tvalue: value\n\t}\n}\n\nClientRequest.prototype.getHeader = function (name) {\n\tvar header = this._headers[name.toLowerCase()]\n\tif (header)\n\t\treturn header.value\n\treturn null\n}\n\nClientRequest.prototype.removeHeader = function (name) {\n\tvar self = this\n\tdelete self._headers[name.toLowerCase()]\n}\n\nClientRequest.prototype._onFinish = function () {\n\tvar self = this\n\n\tif (self._destroyed)\n\t\treturn\n\tvar opts = self._opts\n\n\tvar headersObj = self._headers\n\tvar body = null\n\tif (opts.method !== 'GET' && opts.method !== 'HEAD') {\n\t\tif (capability.arraybuffer) {\n\t\t\tbody = toArrayBuffer(Buffer.concat(self._body))\n\t\t} else if (capability.blobConstructor) {\n\t\t\tbody = new global.Blob(self._body.map(function (buffer) {\n\t\t\t\treturn toArrayBuffer(buffer)\n\t\t\t}), {\n\t\t\t\ttype: (headersObj['content-type'] || {}).value || ''\n\t\t\t})\n\t\t} else {\n\t\t\t// get utf8 string\n\t\t\tbody = Buffer.concat(self._body).toString()\n\t\t}\n\t}\n\n\t// create flattened list of headers\n\tvar headersList = []\n\tObject.keys(headersObj).forEach(function (keyName) {\n\t\tvar name = headersObj[keyName].name\n\t\tvar value = headersObj[keyName].value\n\t\tif (Array.isArray(value)) {\n\t\t\tvalue.forEach(function (v) {\n\t\t\t\theadersList.push([name, v])\n\t\t\t})\n\t\t} else {\n\t\t\theadersList.push([name, value])\n\t\t}\n\t})\n\n\tif (self._mode === 'fetch') {\n\t\tvar signal = null\n\t\tvar fetchTimer = null\n\t\tif (capability.abortController) {\n\t\t\tvar controller = new AbortController()\n\t\t\tsignal = controller.signal\n\t\t\tself._fetchAbortController = controller\n\n\t\t\tif ('requestTimeout' in opts && opts.requestTimeout !== 0) {\n\t\t\t\tself._fetchTimer = global.setTimeout(function () {\n\t\t\t\t\tself.emit('requestTimeout')\n\t\t\t\t\tif (self._fetchAbortController)\n\t\t\t\t\t\tself._fetchAbortController.abort()\n\t\t\t\t}, opts.requestTimeout)\n\t\t\t}\n\t\t}\n\n\t\tglobal.fetch(self._opts.url, {\n\t\t\tmethod: self._opts.method,\n\t\t\theaders: headersList,\n\t\t\tbody: body || undefined,\n\t\t\tmode: 'cors',\n\t\t\tcredentials: opts.withCredentials ? 'include' : 'same-origin',\n\t\t\tsignal: signal\n\t\t}).then(function (response) {\n\t\t\tself._fetchResponse = response\n\t\t\tself._connect()\n\t\t}, function (reason) {\n\t\t\tglobal.clearTimeout(self._fetchTimer)\n\t\t\tif (!self._destroyed)\n\t\t\t\tself.emit('error', reason)\n\t\t})\n\t} else {\n\t\tvar xhr = self._xhr = new global.XMLHttpRequest()\n\t\ttry {\n\t\t\txhr.open(self._opts.method, self._opts.url, true)\n\t\t} catch (err) {\n\t\t\tprocess.nextTick(function () {\n\t\t\t\tself.emit('error', err)\n\t\t\t})\n\t\t\treturn\n\t\t}\n\n\t\t// Can't set responseType on really old browsers\n\t\tif ('responseType' in xhr)\n\t\t\txhr.responseType = self._mode.split(':')[0]\n\n\t\tif ('withCredentials' in xhr)\n\t\t\txhr.withCredentials = !!opts.withCredentials\n\n\t\tif (self._mode === 'text' && 'overrideMimeType' in xhr)\n\t\t\txhr.overrideMimeType('text/plain; charset=x-user-defined')\n\n\t\tif ('requestTimeout' in opts) {\n\t\t\txhr.timeout = opts.requestTimeout\n\t\t\txhr.ontimeout = function () {\n\t\t\t\tself.emit('requestTimeout')\n\t\t\t}\n\t\t}\n\n\t\theadersList.forEach(function (header) {\n\t\t\txhr.setRequestHeader(header[0], header[1])\n\t\t})\n\n\t\tself._response = null\n\t\txhr.onreadystatechange = function () {\n\t\t\tswitch (xhr.readyState) {\n\t\t\t\tcase rStates.LOADING:\n\t\t\t\tcase rStates.DONE:\n\t\t\t\t\tself._onXHRProgress()\n\t\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t\t// Necessary for streaming in Firefox, since xhr.response is ONLY defined\n\t\t// in onprogress, not in onreadystatechange with xhr.readyState = 3\n\t\tif (self._mode === 'moz-chunked-arraybuffer') {\n\t\t\txhr.onprogress = function () {\n\t\t\t\tself._onXHRProgress()\n\t\t\t}\n\t\t}\n\n\t\txhr.onerror = function () {\n\t\t\tif (self._destroyed)\n\t\t\t\treturn\n\t\t\tself.emit('error', new Error('XHR error'))\n\t\t}\n\n\t\ttry {\n\t\t\txhr.send(body)\n\t\t} catch (err) {\n\t\t\tprocess.nextTick(function () {\n\t\t\t\tself.emit('error', err)\n\t\t\t})\n\t\t\treturn\n\t\t}\n\t}\n}\n\n/**\n * Checks if xhr.status is readable and non-zero, indicating no error.\n * Even though the spec says it should be available in readyState 3,\n * accessing it throws an exception in IE8\n */\nfunction statusValid (xhr) {\n\ttry {\n\t\tvar status = xhr.status\n\t\treturn (status !== null && status !== 0)\n\t} catch (e) {\n\t\treturn false\n\t}\n}\n\nClientRequest.prototype._onXHRProgress = function () {\n\tvar self = this\n\n\tif (!statusValid(self._xhr) || self._destroyed)\n\t\treturn\n\n\tif (!self._response)\n\t\tself._connect()\n\n\tself._response._onXHRProgress()\n}\n\nClientRequest.prototype._connect = function () {\n\tvar self = this\n\n\tif (self._destroyed)\n\t\treturn\n\n\tself._response = new IncomingMessage(self._xhr, self._fetchResponse, self._mode, self._fetchTimer)\n\tself._response.on('error', function(err) {\n\t\tself.emit('error', err)\n\t})\n\n\tself.emit('response', self._response)\n}\n\nClientRequest.prototype._write = function (chunk, encoding, cb) {\n\tvar self = this\n\n\tself._body.push(chunk)\n\tcb()\n}\n\nClientRequest.prototype.abort = ClientRequest.prototype.destroy = function () {\n\tvar self = this\n\tself._destroyed = true\n\tglobal.clearTimeout(self._fetchTimer)\n\tif (self._response)\n\t\tself._response._destroyed = true\n\tif (self._xhr)\n\t\tself._xhr.abort()\n\telse if (self._fetchAbortController)\n\t\tself._fetchAbortController.abort()\n}\n\nClientRequest.prototype.end = function (data, encoding, cb) {\n\tvar self = this\n\tif (typeof data === 'function') {\n\t\tcb = data\n\t\tdata = undefined\n\t}\n\n\tstream.Writable.prototype.end.call(self, data, encoding, cb)\n}\n\nClientRequest.prototype.flushHeaders = function () {}\nClientRequest.prototype.setTimeout = function () {}\nClientRequest.prototype.setNoDelay = function () {}\nClientRequest.prototype.setSocketKeepAlive = function () {}\n\n// Taken from http://www.w3.org/TR/XMLHttpRequest/#the-setrequestheader%28%29-method\nvar unsafeHeaders = [\n\t'accept-charset',\n\t'accept-encoding',\n\t'access-control-request-headers',\n\t'access-control-request-method',\n\t'connection',\n\t'content-length',\n\t'cookie',\n\t'cookie2',\n\t'date',\n\t'dnt',\n\t'expect',\n\t'host',\n\t'keep-alive',\n\t'origin',\n\t'referer',\n\t'te',\n\t'trailer',\n\t'transfer-encoding',\n\t'upgrade',\n\t'via'\n]\n\n};"],
"names":["shadow$provide","global","require","module","exports","process","Buffer","capability","inherits","response","stream","toArrayBuffer","IncomingMessage","rStates","readyStates","ClientRequest","module.exports","opts","self","Writable","call","_opts","_body","_headers","auth","setHeader","toString","Object","keys","headers","forEach","name","useFetch","mode","abortController","preferBinary","overrideMimeType","Error","_mode","fetch","mozchunkedarraybuffer","msstream","arraybuffer","vbArray","_fetchTimer","on","_onFinish","prototype","ClientRequest.prototype.setHeader","value","lowerName","toLowerCase","unsafeHeaders","indexOf","getHeader","ClientRequest.prototype.getHeader","header","removeHeader","ClientRequest.prototype.removeHeader","ClientRequest.prototype._onFinish","_destroyed","headersObj","body","method","concat","blobConstructor","Blob","map","buffer","type","headersList","keyName","Array","isArray","v","push","signal","controller","AbortController","_fetchAbortController","requestTimeout","setTimeout","emit","abort","url","undefined","credentials","withCredentials","then","_fetchResponse","_connect","reason","clearTimeout","xhr","_xhr","XMLHttpRequest","open","err","nextTick","responseType","split","timeout","ontimeout","xhr.ontimeout","setRequestHeader","_response","onreadystatechange","xhr.onreadystatechange","readyState","LOADING","DONE","_onXHRProgress","onprogress","xhr.onprogress","onerror","xhr.onerror","send","ClientRequest.prototype._onXHRProgress","status","e","ClientRequest.prototype._connect","_write","ClientRequest.prototype._write","chunk","encoding","cb","destroy","ClientRequest.prototype.destroy","end","ClientRequest.prototype.end","data","flushHeaders","ClientRequest.prototype.flushHeaders","ClientRequest.prototype.setTimeout","setNoDelay","ClientRequest.prototype.setNoDelay","setSocketKeepAlive","ClientRequest.prototype.setSocketKeepAlive"]
}
